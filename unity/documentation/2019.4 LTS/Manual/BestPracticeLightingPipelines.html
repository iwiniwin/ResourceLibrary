<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script> -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="在 Unity 中设置渲染管线和光照 - Unity 手册">
<title>在 Unity 中设置渲染管线和光照 - Unity 手册</title>
<meta property="og:image" content="https://docs.unity3d.com/cn/2019.4/uploads/Main/BestPracticeLightingPipeline3.svg">
<meta name="description" content="本指南是以下 Unity 博客文章的更新版本：聚光灯团队最佳实践：设置光照管线 (Spotlight Team Best Practices: Setting up the Lighting Pipeline) - Pierre Yves Donzallaz。">
<meta property="og:description" content="本指南是以下 Unity 博客文章的更新版本：聚光灯团队最佳实践：设置光照管线 (Spotlight Team Best Practices: Setting up the Lighting Pipeline) - Pierre Yves Donzallaz。">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'BestPracticeLightingPipelines';
      if(!page) page = 'index';
      var version = '2019.4';
      var docs_versions = [{version: '2021.1',version_string: '2021.1',supported: true},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: true},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2019.4/Manual/BestPracticeLightingPipelines.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2019.4/Manual/BestPracticeLightingPipelines.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2019.4/Manual/BestPracticeLightingPipelines.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2019.4/Manual/BestPracticeLightingPipelines.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2019.4/Manual/BestPracticeLightingPipelines.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2019.4/Manual/BestPracticeLightingPipelines.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2019.4/Manual/BestPracticeLightingPipelines.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2019.4/Documentation/Manual/BestPracticeLightingPipelines.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.4</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/BestPracticeLightingPipelines.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/BestPracticeLightingPipelines.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/BestPracticeLightingPipelines.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/BestPracticeLightingPipelines.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/BestPracticeLightingPipelines.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/BestPracticeLightingPipelines.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/BestPracticeLightingPipelines.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/BestPracticeLightingPipelines.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/BestPracticeLightingPipelines.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/BestPracticeLightingPipelines.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/BestPracticeLightingPipelines.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/BestPracticeLightingPipelines.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/BestPracticeLightingPipelines.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/BestPracticeLightingPipelines.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/BestPracticeLightingPipelines.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/BestPracticeLightingPipelines.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/BestPracticeLightingPipelines.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2019.4/Documentation/Manual/BestPracticeLightingPipelines.html">English</a></li>
<li><a data-lang="cn" href="/cn/2019.4/Manual/BestPracticeLightingPipelines.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2019.4/Manual/BestPracticeLightingPipelines.html">日本語</a></li>
<li><a data-lang="es" href="/es/2019.4/Manual/BestPracticeLightingPipelines.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2019.4/Manual/BestPracticeLightingPipelines.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2019.4/Manual/BestPracticeLightingPipelines.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.4</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/BestPracticeLightingPipelines.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/BestPracticeLightingPipelines.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/BestPracticeLightingPipelines.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/BestPracticeLightingPipelines.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/BestPracticeLightingPipelines.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/BestPracticeLightingPipelines.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/BestPracticeLightingPipelines.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/BestPracticeLightingPipelines.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/BestPracticeLightingPipelines.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/BestPracticeLightingPipelines.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/BestPracticeLightingPipelines.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/BestPracticeLightingPipelines.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/BestPracticeLightingPipelines.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/BestPracticeLightingPipelines.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/BestPracticeLightingPipelines.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/BestPracticeLightingPipelines.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/BestPracticeLightingPipelines.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity 用户手册 (2019.4 LTS)</a></li>
<li><a href="BestPracticeGuides.html">最佳实践指南</a></li>
<li>在 Unity 中设置渲染管线和光照</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="BestPracticeMakingBelievableVisuals9.html"></a></span><div class="tip">动态光照</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="ExpertGuides.html"></a></span><div class="tip">专家指南</div>
</div>
</div></div>
<h1>在 Unity 中设置渲染管线和光照</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>本指南是以下 Unity 博客文章的更新版本：<a href="https://blogs.unity3d.com/2018/08/28/spotlight-team-best-practices-setting-up-the-lighting-pipeline/">聚光灯团队最佳实践：设置光照管线 (Spotlight Team Best Practices: Setting up the Lighting Pipeline) - Pierre Yves Donzallaz</a>。</p>

<h2>定义</h2>

<p>首先，让我们来看看在本文中经常遇到的几个重要图形渲染术语的定义。</p>

<ul>
<li>
<a href="render-pipelines.html">渲染管线</a>确定场景中对象的显示方式，分为三个主要阶段。

<ul>
<li>第一步是剔除；它列出了需要渲染的对象，最好是那些对摄像机可见的对象（<a href="https://docs.unity3d.com/Manual/UnderstandingFrustum.html">视锥体剔除</a>）和其他对象不遮挡的对象（<a href="https://docs.unity3d.com/Manual/OcclusionCulling.html">遮挡剔除</a>）。</li>
<li>第二个阶段渲染是指将这些对象绘制到基于像素的缓冲区中（通过正确的光照以及它们的一些属性）。</li>
<li>最后，可以在这些缓冲区上执行后期处理操作，例如，应用颜色分级、泛光和景深，从而生成发送到显示设备的最终输出帧。</li>
</ul>
</li>
</ul>

<p>根据帧率，这些操作每秒钟重复很多次。</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline3.svg" alt="">
</figure>

<ul>
<li>着色器是在图形处理单元 (GPU) 上运行的程序或程序集合的通用名称。例如，在剔除阶段完成后，顶点着色器用于将可见对象的顶点坐标从“对象空间”转换为称为“裁剪空间”的不同空间；然后 GPU 使用这些新的坐标对场景进行光栅化，也就是将场景的矢量表示转换为实际像素。在稍后阶段，这些像素将由像素（或片元）着色器进行着色；像素颜色通常将取决于各自表面的材质属性以及周围的光照。现代硬件上另一种常见的着色器是计算着色器：计算着色器允许程序员利用 GPU 的大量并行处理能力，用于任何类型的数学运算，如光照剔除、粒子物理或体积模拟。</li>
<li>直接光照指的是从自发光光源（如灯泡）发出的光照，而不是光从表面反射的结果。根据光源的大小及其与接收者的距离，这种光照通常会产生清晰的不同阴影。

<ul>
<li>请勿将直接光照与方向光照混淆，后者是指是由无限远的光源（例如计算机模拟的太阳）发出的光。方向光的显著特性是能够用平行光线覆盖整个场景，并且不存在距离衰减（或光衰减）；也就是说，接收到的光照量不会随着与光源距离的增加而衰减。</li>
<li>在现实中，太阳光也会像任何其他光源一样，光照会按照距离的平方反比定律而衰减。简单来说，当接收者与光源之间的距离增加时，收到光照量会迅速降低。例如，水星上的太阳光照度几乎是地球上的 <a href="https://www.nasa.gov/audience/foreducators/9-12/features/F_How_Far_How_Faint.html">7 倍</a>，火星上的太阳光照度是地球的近一半，而冥王星仅仅为 0.06%。然而，对于海拔高度范围非常有限的大多数实时应用程序来说，太阳光的衰减微不足道。因此，方向光完全足以模拟大多数 Unity 场景（包括以行星为中心的大型空旷空间）中的太阳光。</li>
</ul>
</li>
<li>间接光照是由于光从表面反射并通过介质（如大气或半透明物质）传播和散射而形成的结果。在这种状况下，遮挡物通常投射出柔和或难以看清的阴影。</li>
<li>全局光照 (GI) 是对直接和间接光照进行建模以提供逼真光照效果的一组技术。GI 有几种方法，如烘焙/动态光照贴图、辐照度体积、光传播体积、烘焙/动态光照探针、基于体素的 GI 和基于距离场的 GI。Unity 支持开箱即用的烘焙/动态光照贴图和光照探针。</li>
<li>
<a href="Lightmappers.html">光照贴图程序</a>是一个基础系统，它通过发射光线、计算光线反弹并将产生的光线应用到纹理来生成光照贴图和光照探针的数据。因此，不同的光照贴图程序通常会产生不同的光照外观，因为它们可能依赖不同的技术来生成光照数据。</li>
</ul>

<h2>概述</h2>

<p>下面的流程图从内容创建者的角度，大致显示了 Unity 中的整个光照管线。</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline15.svg" alt="">
</figure>

<p>首先要选择一个渲染管线。然后决定如何产生间接光照，并相应地选择一个全局光照系统。确保为您的项目适当地调整了所有全局光照设置之后，您可以继续添加<a href="https://docs.unity3d.com/Manual/Lighting.html">光源</a>、<a href="https://docs.unity3d.com/Manual/StandardShaderMaterialParameterEmission.html">发光表面</a>、<a href="https://docs.unity3d.com/Manual/class-ReflectionProbe.html">反射探针</a>、<a href="https://docs.unity3d.com/Manual/LightProbes.html">光照探针</a>和<a href="https://docs.unity3d.com/Manual/class-LightProbeProxyVolume.html">光照探针代理体 (LPPV)</a>。所有这些光照对象的用法和特性的详细介绍超出了本文的范围，因此，建议您阅读手册中的“光照”部分，以学习如何在项目中正确地使用光照。</p>

<h2>渲染管线</h2>

<p>在 2018 年初之前，Unity 中只有一个渲染管线：<a href="https://docs.unity3d.com/Manual/built-in-render-pipeline.html">内置渲染管线 (Built-In Render Pipeline)</a>。此渲染管线提供了可选择的<a href="https://docs.unity3d.com/Manual/RenderingPaths.html">渲染路径</a>：前向渲染路径和延迟渲染路径。</p>

<ul>
<li>在使用（多通道）<a href="https://docs.unity3d.com/Manual/RenderTech-ForwardRendering.html">前向渲染路径</a>时，场景中的所有对象都是按顺序渲染，根据影响每个对象的光源数量，可能在多个通道中渲染，因此当对象被多个光源照亮时，渲染成本会急剧增加。这种类型的渲染器通常提供各种各样的着色器，并且可以很轻松地处理透明度。</li>
<li>在使用<a href="https://docs.unity3d.com/Manual/RenderTech-DeferredShading.html">延迟渲染路径</a>时，所有（不透明）几何体首先渲染到缓冲区中，在其中存储有关材质的信息（颜色、镜面反射、光滑度等等）。在后一种通道（也就是“延迟”）中，每个像素按顺序着色：渲染时间将主要取决于影响每个像素的光源数量。对于透明对象以及某些包含复杂着色器的对象，仍然需要额外的前向渲染通道。当处理包含许多动态光源的场景时（例如具有人工光照的内部空间，或室外与室内光照相结合的项目），通常建议使用延迟渲染。</li>
</ul>

<p>2018 年 1 月，Unity 推出了<a href="https://docs.unity3d.com/Manual/ScriptableRenderPipeline.html">可编程渲染管线 (SRP)</a>，允许通过 C# 脚本来自定义渲染循环。这实际上是游戏引擎领域的一次小革命：用户终于无需使用像 C++ 这样的低级编程语言便可以个性化设置对象剔除、绘制和帧后期处理。</p>

<p>Unity 当前提供两个预先构建的 SRP：</p>

<ul>
<li>
<a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@latest">高清渲染管线 (HDRP)</a> 是一种混合延迟/前向瓦片/聚类渲染器。它提供了先进的渲染和着色功能，是专为要求逼真视觉的 PC 和高端游戏主机项目而设计。</li>
</ul>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline6.svg" alt="">
</figure>

<p>瓦片是帧的一个小型二维方形像素部分，而聚类则是摄像机视锥体中的一个三维体积。瓦片和聚类渲染技术都依赖于影响每个瓦片和聚类的光源的列表，然后可以用相应的已知光源列表在一个通道中计算其光照。不透明对象很可能使用瓦片系统进行着色，而透明对象则依赖于聚类系统。该渲染器的主要优点是，与内置渲染管线（延迟）相比，光照处理速度更快，带宽消耗也大大减少，因为内置渲染管线依赖于更慢的多通道光照积累。</p>

<ul>
<li>
<a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@latest/index.html?subfolder=/manual/index.html">通用渲染管线 (URP)</a> 是一种快速的单通道前向渲染器；它主要设计用于不支持计算着色器技术的低端设备，例如较早的智能手机、平板电脑和 XR 设备。但是，URP 还可为中端设备（如游戏主机和 PC）提供更高质量的图形性能，有时其性能成本低于内置渲染管线。URP 根据每个对象来剔除光线，并允许在单个通道中计算光照，与内置渲染管线相比，这会降低绘制调用次数。最后，URP 还提供 2D 渲染器，并规划了延迟渲染器。</li>
</ul>

<p>您可以使用下面的决策图表来快速确认您应该根据几个关键标准选择哪一种渲染管线。</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline16.svg" alt="">
</figure>

<h3>设置</h3>

<p>可以通过 Unity Package Manager (<strong>Window</strong> &gt; <strong>Package Manager</strong>) 来下载最新版本的 HDRP 和 URP。要使用这些 SRP 的其中之一，最简单的方法是使用 <a href="https://docs.unity3d.com/Manual/GettingStartedInstallingHub.html">Unity Hub</a> 来创建一个新项目并使用其中一个对应的模板。</p>

<p>如果要为项目设置 HDRP，请确保安装了所需的包。然后，使用 <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@latest/index.html?subfolder=/manual/Render-Pipeline-Wizard.html">HD Render Pipeline Wizard</a> (<strong>Window</strong> &gt; <strong>Render Pipeline</strong> &gt; <strong>HD Render Pipeline Wizard</strong>) 来一键设置您的项目。</p>

<h3>可扩展性</h3>

<p>如果您略懂渲染方面的知识，熟悉 C#，并需要为项目完全定制渲染器，您可以试着使用 SRP 概念来创建您自己的自定义可编程渲染管线。因为通用渲染管线的着色器库较小并且能够快速注入、删除和交换渲染通道，因此可以对通用渲染管线进行轻松扩展。</p>

<h3>兼容性</h3>

<p>在 Unity 中将项目的材质从内置渲染管线移植到 HDRP 或 URP 相对比较容易，这要归功于 <strong>Edit</strong> &gt; <strong>Render Pipeline</strong> &gt; <strong>Upgrade…</strong> 下的一键材质转换器。请注意，这种操作是不可逆的。强烈建议提前备份您的项目！</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline9.png" alt="">
</figure>

<p>尽管如此，必须手动移植自定义着色器，因此在生产过程中从内置渲染管线过渡到 HDRP 或 URP 可能会耗费时间，具体时间取决于必须重新编写的自定义着色器数量。</p>

<p>此外，由于 HDRP 在物理上比内置渲染管线更正确，特别是在光衰减和分布方面，因此在切换到 HDRP 之后，项目应该会有所不同。</p>

<p>此外，HDRP 和 URP 并不是交叉兼容的，因为它们没有共同的渲染特征。可以将项目从 HDRP 移植到 URP，反过来也可以，但并不是一键操作，而是需要手动重新制作光照、材质和着色器！</p>

<h2>全局光照系统</h2>

<p>如果要在场景中添加间接光照，必须使用 Unity 的两个全局光照系统之一，或者使用您自己的烘焙解决方案生成这种光照。在 Unity 的 Window &gt; Rendering &gt; Lighting Settings 下提供的这两个系统是：</p>

<p>1.<a href="realtime-gi-using-enlighten.html">实时全局光照</a>：这个系统完全依赖于第三方光照中间件 Enlighten。在 Unity 中的预计算期间，Enlighten 经历两个漫长的阶段：聚类和光线传输。第一个阶段是将场景简化为一组称为聚类的面片，第二个阶段是计算这些聚类之间的可见性。在运行时，这些预计算的数据用于以交互方式生成间接光照。Enlighten 的强大功能依赖于实时编辑光照的能力，因为预计算的数据依赖于聚类间的关系。然而，与其他传统的光照贴图技术一样，编辑场景中的静态几何体将触发新的预计算。目前正在从 Unity 中移除 Enlighten，并在研究一种新的解决方案。
 * HDRP 对于 Unity 2019.3 及更高版本中的新项目不支持实时全局光照。尽管如此，在 Unity 2019.3 之前创建的项目仍可以升级到 2019.3 或 2019 LTS。
 * URP 从未支持使用 Enlighten 提供实时全局光照。
 * 内置渲染管线将支持使用 Enlighten 提供实时全局光照，直到 Unity 2020 <a href="https://unity3d.com/unity/qa/lts-releases">LTS</a>（2020 年底或 2021 年初）为止。这意味着该版本的重大错误修复将继续到 2022 年底或 2023 年初。</p>

<p>总而言之，如果您要在 Unity 2019.3 或更高版本中创建新项目，则在使用 URP 或 HDRP 的情况下将不可使用 Enlighten。如果选择内置渲染管线，则 Enlighten 将保持可用状态，直到 2020 年底或 2021 年初。</p>

<p>2.烘焙全局光照：光照被烘焙成称为光照贴图的纹理以及光照探针。烘焙 GI 系统可以使用下列其中一个光照贴图程序：
 * <a href="https://docs.unity3d.com/Manual/progressive-lightmapper.html">渐进光照贴图程序 (Progressive Lightmapper)</a>
 * <a href="https://docs.unity3d.com/Manual/GI-Enlighten.html">Enlighten</a></p>

<p>渐进光照贴图程序可以优先计算摄像机视野内对象的光照，并大大加快光照的迭代速度，而代价是增加整个场景的整体烘焙时间。渐进光照贴图程序使用 CPU 根据路径追踪来计算间接光照。一种新的 <a href="GPUProgressiveLightmapper.html">GPU 渐进光照贴图程序</a>目前处于预览版，将极大降低场景的烘焙时间。</p>

<p>因为 Enlighten 和渐进光照贴图程序使用不同的方法产生烘焙光照，因此在比较这两者时，不应该期望得到完全匹配的光照效果。</p>

<p>请查看下面的图表，确定项目适合使用哪种全局光照系统，以及该系统的主要优点和缺点。</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline4.svg" alt="">
</figure>

<h3>静态与动态对比</h3>

<p>无论使用哪种全局光照系统，在烘焙/预计算光照过程中，Unity 只会考虑标记为<a href="https://docs.unity3d.com/Manual/StaticObjects.html">“Contribute GI”</a>的对象。动态（即非静态）对象必须依赖于放置在整个场景中的光照探针来获得间接光照。</p>

<p>由于光照的烘焙/预计算是一个相对缓慢的过程，所以只有具有不同光照变化（例如凹度和自我阴影）的大型和复杂资源才应被标记为“Contribute GI”。获得均匀光照的较小和凸面网格不应进行这样的标记，因此它们应该从<a href="https://docs.unity3d.com/Manual/LightProbes.html">光照探针</a>获得间接光照；光照探针中存储了更简单的光照近似值。较大的动态对象可以依赖 <a href="https://docs.unity3d.com/Manual/class-LightProbeProxyVolume.html">LPPV</a>，以便获得更好的本地化间接光照。要最大程度减少烘焙时间并同时保持足够的光照质量，最重要的就是限制场景中标记为“Contribute GI”的对象数量。可在本<a href="https://unity3d.com/learn/tutorials/topics/graphics/introduction-precomputed-realtime-gi?playlist=17102">教程</a>中详细了解这个优化过程和探针光照的重要性。</p>

<h3>警告</h3>

<p>Unity 允许烘焙和实时 GI 系统同时有效，因此可以访问所有光照功能。但是，务必注意，同时启用这两个系统会大大增加运行时的烘焙时间和内存使用量，因为这些系统不依赖相同的数据集。此外，在运行时对间接光照的交互式更新将给 CPU 带来更大的压力，而且在视觉上比较烘焙和实时 GI 系统提供的间接光照时，应该会看到差异，因为它们依赖不同的技术来模拟间接光照，并且通常以明显不同的分辨率运行。</p>

<p>同时使用这两个 GI 系统应仅限于高端平台和/或以可预测的成本对场景进行严格控制的项目。这种方法只应由非常了解所有光照设置的专家用户使用，因为同时管理这两个系统会增加很大的复杂性。所以，对大多数项目来说，选择两个 GI 系统的其中一个通常是更安全的策略。很少推荐同时使用这两个系统！</p>

<h3>光照模式</h3>

<p>Light 组件的 Mode 属性是一种常常让人混淆的属性。</p>

<p><a href="class-Light.html">Light Inspector</a> 中提供了三种<a href="LightModes.html">光照模式</a>：</p>

<p>1.<a href="LightMode-Baked.html">烘焙</a>：从这些光源产生的直接和间接光照被烘焙成光照贴图，这可能是一个耗时的过程。处理这些光源不需要运行时成本，但是将所产生的光照贴图应用到场景中确实需要很小的成本。
2.<a href="LightMode-Realtime.html">实时</a>：来自这些光源的直接光照和阴影是实时的，因此不会被烘焙成光照贴图。它们的运行成本可能很高，具体取决于场景的复杂性、阴影投射光源的数量、重叠光源的数量等。此外，如果启用实时全局光照，则会在运行时更新间接光照，从而产生性能成本。
3.<a href="LightMode-Mixed.html">混合</a>：这种混合模式提供烘焙和实时功能（如烘焙间接光照和实时直接光照）的混合。场景中所有混合光源的行为及其性能影响取决于该场景的<a href="lighting-mode.html">光照模式</a>。</p>

<p>必须注意的是，只有启用了烘焙全局光照系统时，光源的模式才有意义。如果不使用任何 GI 系统或只使用实时 GI 系统，那么所有烘焙光源和混合光源的行为就好像它们的 Mode 属性设置为 Realtime 一样。</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline7.svg" alt="">
</figure>

<p>下面的图表结合了一个决策流程图和一个比较表；可以帮助您决定每次在场景中添加新光源时哪种光源模式合适。</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline12.svg" alt="">
</figure>

<h3>光照模式</h3>

<p>如前面的图表中所示，场景中的所有混合光源具有特定的烘焙和实时功能，具体取决于您在 Lighting 窗口中选择的光照模式 (Lighting Mode)。</p>

<p>有三种模式可供选择：</p>

<p>1.Subtractive
2.Baked Indirect
3.Shadowmask</p>

<p>Shadowmask 光照模式有两个质量设置：</p>

<p>1.Shadowmask
2.Distance Shadowmask</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline5.svg" alt="">
</figure>

<p>使用 HDRP 的<a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@latest/index.html?subfolder=/manual/Lighting-Mode-Shadowmask.html">阴影遮罩光照模式 (Shadowmask Lighting Mode)</a> 时，在 Graphics 设置中分配的 HDRP 资源中会启用阴影遮罩功能；然后必须通过 <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@latest/index.html?subfolder=/manual/Frame-Settings.html">Frame Settings</a> 专门为您的摄像机激活该功能。</p>

<h2>渲染管线比较表</h2>

<p>下表概述了 Unity 2019.3 中每个渲染管线支持的功能。</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline8.svg" alt="">
</figure>

<h2>光照情形</h2>

<p>我们已经介绍了渲染管线和主要光照功能，现在让我们看看几个项目的例子，看看可以使用哪些设置来提供光照。由于每个项目都是独一无二的，因此您可能会根据自己的需求使用稍微不同的选项。</p>

<h3>1.原型构建或快速预先可视化</h3>

<p>如果您严重依赖 Asset Store 来构建原型，则内置渲染管线可能是唯一合适的渲染管线，因为 Asset Store 中的大多数资源并不完全兼容 HDRP 和 URP；尽管如此，资源兼容性将随着时间推移而改善。如果您要从头开始构建所有资源，并且已经清楚了解了自己项目的需求，那么您可以从这两个 SRP（即 URP 或 HDRP）中选择一个，甚至创建一个自定义 SRP。</p>

<p>如果处于（预）生产的早期阶段，并且需要快速周转时间和最大的光照灵活性，您可能更想要使用一种不需要任何预计算的完全实时方法，因此您可能希望同时关闭烘焙和实时 GI 系统。为了缓解缺少正确间接光照的问题，您可以启用屏幕空间环境光遮挡 (Screen Space Ambient Occlusion)：该功能可以提供低成本的实时接触阴影，从而帮助场景中的对象上底色。</p>

<h3>2.3D 手机策略游戏</h3>

<p>如果目标平台是移动设备，URP 可能是很好的候选项，可确保策略游戏的扎实性能。如果需要自定义渲染管线以更好地适应游戏，图形开发程序员可能会发现，扩展 URP 会更加简单明了。如果选择 URP 并且使用烘焙全局光照，请注意，目前不支持阴影遮罩混合光照模式 (Shadowmask Mixed Lighting Mode)。</p>

<p>或者，如果您决定坚持使用内置渲染管线，例如，由于您依赖 Asset Store 中的许多资源，那么所有混合光照模式都受支持。在这种情况下，采用阴影遮罩光照模式 (Shadowmask Lighting Mode) 的方法将提供烘焙阴影，同时仍然允许动态对象投射实时阴影。如果阴影遮罩对您的项目来说成本过高，则可以回退到最低成本的 Subtractive 模式。最后一点，如果关卡中有非常少的光源，且目标平台采用旧硬件，那么前向渲染路径可能是最好的选择。</p>

<h3>3.AAA 级走廊射击游戏（一天中的固定时间）</h3>

<p>如果目标是在 PC 和游戏主机上实现线性第一人称射击游戏的 AAA 级质量视觉效果，HDRP 应该是首选的渲染管线。同样，还可以在图形开发程序员的帮助下开发自定义 SRP。</p>

<p>如果关卡包含许多投射实时阴影的光源（例如，可破坏的灯光道具和移动光源），那么应该将烘焙 GI 系统与 Baked Indirect 模式配合使用，这样可以确保混合方向光和静态灯光道具中的烘焙光源呈现出良好的间接光照效果。如果关卡中大部分都是投射固定阴影的光源，那么推荐使用阴影遮罩的方法，因为 HDRP 提供了一个很好的混合阴影遮罩模式，允许更精细地控制实时阴影和烘焙阴影之间的混合。</p>

<p>如果您还计划支持 Nintendo Switch，则建议您使用 URP，这样您就可以支持市场上的大多数游戏平台，而不必经历将项目从 HDRP 移植到 URP（或反之）的繁琐过程。</p>

<h3>4.大逃杀游戏（昼夜周期）</h3>

<p>如果您计划发布一款面向 PC 和游戏主机的大逃杀类型游戏（特征是包含大规模环境和完全动态光照），那么应该选择 HDRP，或者进行扩展以便为项目量身定制渲染管线。如果目标不是实现 AAA 级逼真视觉效果，而是面向低规格的移动设备或系统，那么可以考虑使用 URP。</p>

<p>为了适应昼夜周期，由于 HDRP 和 URP 不支持实时全局光照系统 (Enlighten)，因此必须使用间接烘焙和自定义脚本来处理昼夜周期，例如，这样可以模拟一整天中的太阳光和间接光强度。</p>

<p>对于这个特定的场景，例如，如果您使用的是内置渲染管线，不建议同时激活实时 GI 系统和烘焙 GI 系统，因为对于庞大的关卡，性能和场景管理方面产生的开销可能至关重要。反对同时使用这两个 GI 系统的另一个理由是，这样大规模的多人游戏存在着不可预知性：例如，性能估算要远远难于高度可编程的线性关卡。</p>

<h2>结束语</h2>

<p>由于引入了可编程渲染管线，Unity 中的渲染架构在过去的几年中发生了翻天覆地的变化。因此，要弄清楚所有这些变化及其对光照管线的影响可能会令人筋疲力尽。</p>

<p>希望本指南和及其多个插图能让您更好地理解每个渲染管线的功能，从而能在 Unity 中满怀信心地使用合适的渲染和光照设置让您项目大放异彩！</p>

<p>可通过以下页面来详细了解 Unity 中的光照和渲染管线：</p>

<ul>
<li><a href="https://unity3d.com/learn/tutorials/topics/graphics/introduction-lighting-and-rendering?playlist=17102">光照与渲染简介 (Introduction to Lighting and Rendering) 教程</a></li>
<li><a href="https://docs.unity3d.com/Manual/ProjectTemplates.html">通过 Unity Hub 开始使用 HDRP、URP 或内置渲染管线</a></li>
<li><a href="https://unity3d.com/learn/tutorials/s/creating-believable-visuals">创建逼真视觉效果 (Creating Believable Visuals) 教程（内置渲染管线）</a></li>
<li><a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@latest">通用渲染管线文档</a></li>
<li><a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@latest">高清渲染管线文档</a></li>
</ul>
<!-- area:graphics -->
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="BestPracticeMakingBelievableVisuals9.html"></a></span><div class="tip">动态光照</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="ExpertGuides.html"></a></span><div class="tip">专家指南</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">版权所有 © 2020 Unity Technologies. Publication 2019.4</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
