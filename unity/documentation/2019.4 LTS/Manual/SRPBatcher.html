<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script> -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="可编程渲染管线 SRP Batcher - Unity 手册">
<title>可编程渲染管线 SRP Batcher - Unity 手册</title>
<meta property="og:image" content="https://docs.unity3d.com/cn/2019.4/uploads/Main/SRPBatcher.png">
<meta name="description" content="SRP Batcher 是一个渲染循环，可通过许多使用同一着色器变体的材质来加快场景中的 CPU 渲染速度。">
<meta property="og:description" content="SRP Batcher 是一个渲染循环，可通过许多使用同一着色器变体的材质来加快场景中的 CPU 渲染速度。">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'SRPBatcher';
      if(!page) page = 'index';
      var version = '2019.4';
      var docs_versions = [{version: '2021.1',version_string: '2021.1',supported: true},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: true},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2019.4/Manual/SRPBatcher.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2019.4/Manual/SRPBatcher.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2019.4/Manual/SRPBatcher.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2019.4/Manual/SRPBatcher.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2019.4/Manual/SRPBatcher.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2019.4/Manual/SRPBatcher.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2019.4/Manual/SRPBatcher.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2019.4/Documentation/Manual/SRPBatcher.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.4</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/SRPBatcher.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/SRPBatcher.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/SRPBatcher.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/SRPBatcher.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/SRPBatcher.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/SRPBatcher.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/SRPBatcher.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/SRPBatcher.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/SRPBatcher.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/SRPBatcher.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/SRPBatcher.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/SRPBatcher.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/SRPBatcher.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/SRPBatcher.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/SRPBatcher.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/SRPBatcher.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/SRPBatcher.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2019.4/Documentation/Manual/SRPBatcher.html">English</a></li>
<li><a data-lang="cn" href="/cn/2019.4/Manual/SRPBatcher.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2019.4/Manual/SRPBatcher.html">日本語</a></li>
<li><a data-lang="es" href="/es/2019.4/Manual/SRPBatcher.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2019.4/Manual/SRPBatcher.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2019.4/Manual/SRPBatcher.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.4</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/SRPBatcher.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/SRPBatcher.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/SRPBatcher.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/SRPBatcher.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/SRPBatcher.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/SRPBatcher.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/SRPBatcher.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/SRPBatcher.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/SRPBatcher.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/SRPBatcher.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/SRPBatcher.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/SRPBatcher.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/SRPBatcher.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/SRPBatcher.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/SRPBatcher.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/SRPBatcher.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/SRPBatcher.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity 用户手册 (2019.4 LTS)</a></li>
<li><a href="Graphics.html">图形</a></li>
<li><a href="render-pipelines.html">渲染管线</a></li>
<li><a href="ScriptableRenderPipeline.html">可编程渲染管线</a></li>
<li>可编程渲染管线 SRP Batcher</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="srp-using-scriptable-render-context.html"></a></span><div class="tip">在可编程渲染管线中调度和执行渲染命令</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="CamerasOverview.html"></a></span><div class="tip">摄像机</div>
</div>
</div></div>
<h1>可编程渲染管线 SRP Batcher</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>SRP Batcher 是一个渲染循环，可通过许多使用同一着色器变体的材质来加快场景中的 CPU 渲染速度。</p>

<figure>
<img src="../uploads/Main/SRPBatcher.png" alt="可编程渲染管线 SRP Batcher 通过许多使用同一着色器变体的材质来加快场景中的 CPU 渲染速度。">
<figcaption>可编程渲染管线 SRP Batcher 通过许多使用同一着色器变体的材质来加快场景中的 CPU 渲染速度。</figcaption>
</figure>

<h2>启用 SRP Batcher</h2>

<p>要使用 SRP Batcher，项目必须使用<a href="ScriptableRenderPipeline.html">可编程渲染管线</a>。可编程渲染管线可以是：</p>

<ul>
<li>
<a href="universal-render-pipeline.html">通用渲染管线 (URP)</a>。</li>
<li>
<a href="high-definition-render-pipeline.html">高清渲染管线 (HDRP)</a>。</li>
<li>
<a href="ScriptableRenderPipeline.html">自定义 SRP</a>。</li>
</ul>

<p>要在 URP 或 HDRP 中激活 SRP Batcher，请执行以下操作：</p>

<p>1.在 Hierarchy 窗口中，选择 <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@latest/index.html?subfolder=/manual/universalrp-asset.html">URP 资源</a>或 <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@latest/index.html?subfolder=/manual/HDRP-Asset.html">HDRP 资源</a>。
2.在该资源的 Inspector 中，找到 <strong>Advanced</strong> 部分，然后选中 <strong>SRP Batcher</strong> 复选框。</p>

<figure>
<img src="../uploads/Main/SRPBatcher_Asset.png" alt="可以分别在资源中为 URP 或 HDRP 停用 SRP Batcher。默认情况下已启用 SRP Batcher。">
<figcaption>可以分别在资源中为 URP 或 HDRP 停用 SRP Batcher。默认情况下已启用 SRP Batcher。</figcaption>
</figure>

<p>要在运行时启用或禁用 SRP Batcher，请在 C# 代码中切换以下全局变量：</p>

<pre><code>GraphicsSettings.useScriptableRenderPipelineBatching = true;`
</code></pre>

<h2>支持的平台</h2>

<p>SRP Batcher 适用于几乎所有平台。下表显示了支持的平台以及所需的最低 Unity 版本。</p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:center;">
</colgroup>

<tbody>
<tr>
	<td style="text-align:left;"><strong>Platform</strong></td>
	<td style="text-align:center;"><strong>Minimum Unity version required</strong></td>
</tr>
<tr>
	<td style="text-align:left;">Windows DirectX 11</td>
	<td style="text-align:center;">2018.2</td>
</tr>
<tr>
	<td style="text-align:left;">PlayStation 4</td>
	<td style="text-align:center;">2018.2</td>
</tr>
<tr>
	<td style="text-align:left;">Vulkan</td>
	<td style="text-align:center;">2018.3</td>
</tr>
<tr>
	<td style="text-align:left;">OSX Metal</td>
	<td style="text-align:center;">2018.3</td>
</tr>
<tr>
	<td style="text-align:left;">iOS Metal</td>
	<td style="text-align:center;">2018.3</td>
</tr>
<tr>
	<td style="text-align:left;">Nintendo Switch</td>
	<td style="text-align:center;">2018.3</td>
</tr>
<tr>
	<td style="text-align:left;">Xbox One DirectX 11</td>
	<td style="text-align:center;">2019.2</td>
</tr>
<tr>
	<td style="text-align:left;">OpenGL 4.2 and higher</td>
	<td style="text-align:center;">2019.1</td>
</tr>
<tr>
	<td style="text-align:left;">OpenGL ES 3.1 and higher</td>
	<td style="text-align:center;">2019.1</td>
</tr>
<tr>
	<td style="text-align:left;">Xbox One DirectX 12</td>
	<td style="text-align:center;">2019.1</td>
</tr>
<tr>
	<td style="text-align:left;">Windows DirectX 12</td>
	<td style="text-align:center;">2019.1</td>
</tr>
</tbody>
</table>

<p><strong>注意：</strong>对于 XR，只能以 <a href="../ScriptReference/XR.XRSettings.StereoRenderingMode.SinglePassInstanced.html"><code>SinglePassInstanced</code></a> 模式来使用 SRP Batcher。</p>

<h2>SRP Batcher 的工作原理</h2>

<p>Unity 中，可以在一帧内的任何时间修改任何材质的属性。但是，这种做法有一些缺点。例如，DrawCall 使用新材质时，要执行许多作业。因此，场景中的材质越多，Unity 必须用于设置 GPU 数据的 CPU 也越多。解决此问题的传统方法是减少 DrawCall 的数量以优化 CPU 渲染成本，因为 Unity 在发出 DrawCall 之前必须进行很多设置。实际的 CPU 成本便来自该设置，而不是来自 GPU DrawCall 本身（DrawCall 只是 Unity 需要推送到 GPU 命令缓冲区的少量字节）。</p>

<p>SRP Batcher 通过批处理一系列 <code>Bind</code> 和 <code>Draw</code> GPU 命令来减少 DrawCall 之间的 GPU 设置。</p>

<figure>
<img src="../uploads/Main/SROShaderPass.png" alt="Bind 和 Draw 命令的批处理可以减少绘制调用之间的 GPU 设置。">
<figcaption>Bind 和 Draw 命令的批处理可以减少绘制调用之间的 GPU 设置。</figcaption>
</figure>

<p>为了获得最大渲染性能，这些批次必须尽可能大。为了实现这一点，可以使用尽可能多具有相同着色器的不同材质，但是必须使用尽可能少的着色器变体。</p>

<p>在内渲染循环中，当 Unity 检测到新材质时，CPU 会收集所有属性并在 GPU 内存中设置不同的常量缓冲区。GPU 缓冲区的数量取决于着色器如何声明其 CBUFFER。</p>

<p>为了在场景使用很多不同材质但很少使用着色器变体的一般情况下加快速度，SRP 在原生集成了范例（例如 GPU 数据持久性）。</p>

<p>SRP Batcher 是一个低级渲染循环，使材质数据持久保留在 GPU 内存中。如果材质内容不变，SRP Batcher 不需要设置缓冲区并将缓冲区上传到 GPU。实际上，SRP Batcher 会使用专用的代码路径来快速更新大型 GPU 缓冲区中的 Unity 引擎属性，如下所示：</p>

<figure>
<img src="../uploads/Main/SRP_Batcher_loop.png" alt="这是 SRP Batcher 渲染工作流程。SRP Batcher 使用专用的代码路径来快速更新大型 GPU 缓冲区中的 Unity 引擎属性。">
<figcaption>这是 SRP Batcher 渲染工作流程。SRP Batcher 使用专用的代码路径来快速更新大型 GPU 缓冲区中的 Unity 引擎属性。</figcaption>
</figure>

<p>在此处，CPU 仅处理上图中标记为 <em>Per Object large buffer</em> 的 Unity 引擎属性。所有材质在 GPU 内存中都有持久的 CBUFFER，可供随时使用。这样会加快渲染速度，原因是：
现在，所有材质内容都持久保留在 GPU 内存中。
专用代码针对所有每对象属性，管理着一个大型的每对象 GPU CBUFFER。</p>

<h3>SRP Batcher 兼容性</h3>

<p>为了使 SRP Batcher 代码路径能够渲染对象：</p>

<ul>
<li>渲染的对象必须是网格或蒙皮网格。该对象不能是粒子。</li>
<li>着色器必须与 SRP Batcher 兼容。HDRP 和 URP 中的所有光照和无光照着色器均符合此要求（这些着色器的“粒子”版本除外）。</li>
</ul>

<p>为了使着色器与 SRP Batcher 兼容：</p>

<ul>
<li>必须在一个名为“UnityPerDraw”的 CBUFFER 中声明所有内置引擎属性。例如：<code>unity_ObjectToWorld</code> 或 <code>unity_SHAr</code>。</li>
<li>必须在一个名为 <code>UnityPerMaterial</code> 的 CBUFFER 中声明所有材质属性。</li>
</ul>

<p>可以在 Inspector 面板中查看着色器的兼容性状态。</p>

<figure>
<img src="../uploads/Main/SRP_batcher_shader_compatibility.png" alt="可以在 Inspector 面板中检查特定着色器的兼容性。">
<figcaption>可以在 Inspector 面板中检查特定着色器的兼容性。</figcaption>
</figure>

<p>在任何给定场景中，有些对象与 SRP Batcher 兼容，而有些对象则不兼容。即使在使用不兼容的对象时，Unity 也会正确渲染场景。这是因为兼容对象使用 SRP Batcher 代码路径，而其他对象则使用标准 SRP 代码路径。</p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">使用 SRP Batcher 代码路径</th>
	<th style="text-align:left;">不使用 SRP Batcher 代码路径</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">* 使用与 SRP Batcher 兼容的着色器的网格</td>
	<td style="text-align:left;">* 任何非网格对象（包括蒙皮网格）<br>* 任何使用非兼容着色器的网格<br>* 使用材质属性块的渲染器</td>
</tr>
</tbody>
</table>

<h3>使用 SRP Batcher 时的性能分析</h3>

<p>为了测量使用 SRP Batcher 时场景中的增速，请将 <a href="https://github.com/Unity-Technologies/SRPBatcherBenchmark.git"><code>SRPBatcherProfiler.cs</code></a> C# 脚本从 SRP Batcher 模板添加到您的场景。当此脚本正在运行时：
使用 F8 键来切换覆盖显示。
也可以在运行过程中使用 F9 键来打开和关闭 SRP Batcher。</p>

<p>此覆盖如下所示：</p>

<figure>
<img src="../uploads/Main/SRP_Batcher_overlay.png" alt="在 SRP Batcher 覆盖中，可以找到有关 SRP Batcher 中发生的情况的详细信息。">
<figcaption>在 SRP Batcher 覆盖中，可以找到有关 SRP Batcher 中发生的情况的详细信息。</figcaption>
</figure>

<p>时间测量值以毫秒 (ms) 为单位，并显示 CPU 在 Unity SRP 渲染循环中花费的时间。</p>

<p><strong>注意：</strong>此处的时间等于在一帧内调用的所有 <code>RenderLoop.Draw</code> 和 <code>Shadows.Draw</code> 标记的累积时间（与线程所有者无关）。例如，如果看到 1.31ms SRP Batcher 代码路径，表示绘制调用可能在主线程上花费了 0.31ms，并且 1ms 分散在所有图形作业中。</p>

<h4>覆盖信息</h4>

<p>下表描述了在运行模式下可见的 SRP Batcher 覆盖中的每个设置：</p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;" colspan="2">覆盖中的名称</th>
	<th style="text-align:left;">描述</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;" colspan="2">
<strong>(SRP batcher ON)</strong>/<strong>(SRP batcher OFF)</strong>
</td>
	<td style="text-align:left;">指示是否已启用当前的 SRP Batcher。要打开或关闭 SRP Batcher，请按 F9。</td>
</tr>
<tr>
	<td style="text-align:left;" colspan="2"><strong>CPU Rendering time</strong></td>
	<td style="text-align:left;">指示 SRP 循环在 CPU 中花费的总累积时间，无论使用的是哪种多线程模式（例如单个客户端/工作线程或图形作业）。在这里可以最大限度看到 SRP Batcher 的效果。要查看 SRP Batcher 的优化，请尝试将其打开和关闭来查看 CPU 使用率的差异。在上述示例中，总时间为 2.11 毫秒。<br><strong>(incl RT idle)：__指示 SRP 在渲染线程中花费的空闲时间。这可能意味着应用程序处于没有任何图形作业的客户端/工作模式；在渲染线程必须等待主线程上的图形命令时会发生此情况。在以上示例中，渲染线程空闲了 0.36 毫秒。|
||</strong>SRP Batcher code path (flushes)<strong>|指示您的游戏或应用程序花费在 SRP Batcher 代码路径中的时间。此时间包括游戏渲染 </strong>All objects__（阴影通道除外）(1.18ms) 和 <strong>Shadows</strong> (1.13ms) 这两个方面。如果 <strong>Shadows</strong> 数量较大，请尝试减少场景中阴影投射光源的数量，或在渲染管线资源中选择较少数量的级联。在以上示例中，该时间为 1.31ms。<br><strong>(flush)</strong> 数字表示 Unity 由于遇到新着色器变体而刷新场景的次数（在此示例中为 89）。较少的刷新次数总是更好一些，因为这意味着帧中的着色器变体数量较少。</td>
</tr>
<tr>
	<td style="text-align:left;"></td>
	<td style="text-align:left;"><strong>Standard code path (flushes)</strong></td>
	<td style="text-align:left;">指示 Unity 在渲染与 SRP Batcher 不兼容的对象（例如蒙皮网格或粒子）方面花费的时间。<br>在以上示例中，SRP Batcher 在 0.80 毫秒内刷新了 81 个对象：阴影通道为 0.09 毫秒，所有其他通道为 0.71 毫秒。</td>
</tr>
<tr>
	<td style="text-align:left;" colspan="2"><strong>Global Main Loop: (FPS)</strong></td>
	<td style="text-align:left;">指示全局主循环时间（以毫秒为单位）以及等效的每秒帧数 (FPS)。<strong>注意：</strong>FPS 并非线性，因此，如果发现 FPS 增加 20，不一定意味着已经优化场景。若要查看 SRP Batcher 是否优化了场景渲染，请开启和关闭该功能，然后比较 <strong>CPU Rendering time</strong> 下的数字。</td>
</tr>
</tbody>
</table>

<h2>Unity 帧调试器中的 SRP Batcher 数据</h2>

<p>可以在 <a href="FrameDebugger.html">Frame Debugger</a> 窗口中检查 SRP Batcher“批次”的状态。</p>

<p>要检查 SRP Batcher 批次的状态，请执行以下操作：</p>

<p>1.在 Editor 中，选择 <strong>Window</strong> &gt; <strong>Analysis</strong> &gt; <strong>Frame Debugger</strong> &gt; <strong>Render Camera</strong> &gt; <strong>Render Opaques__，然后展开 </strong>RenderLoopNewBatcher.Draw__ 列表。
2.单击要检查的 <strong>SRP Batch</strong>。</p>

<p><strong>SRP Batch</strong> 详细信息可以显示使用了多少个绘制调用、着色器附加了哪些关键字以及该特定绘制调用未与前一个调用一起接受批处理的原因。在以下示例中，所述原因是：_Node use different shader keywords_。这意味着该批次的着色器关键字不同于前一个批次中的关键字。由于 SRP Batcher 使用了另一个不同的着色器变体，因此这一批次已破坏。如果一个 SRP 批次的绘制调用数量较少，您很可能使用了太多的着色器变体。</p>

<figure>
<img src="../uploads/Main/SRP_Batcher_batch_information.png" alt="在 Frame Debugger 窗口中，可以找到有关各个批次的详细信息，包括 SRP Batcher 创建新批次而不是继续使用现有批次的原因。">
<figcaption>在 Frame Debugger 窗口中，可以找到有关各个批次的详细信息，包括 SRP Batcher 创建新批次而不是继续使用现有批次的原因。</figcaption>
</figure>

<p>如果您要编写自己的 SRP 而不是使用 URP 或 HDRP，请尝试使用最少的关键字来编写通用的“超级”着色器（但可以在每个材质中使用尽可能多的材质参数和材质属性）。</p>

<hr>

<ul>
<li><p><span class="page-edit">2019–06–09 页面已发布</span></p></li>
<li><p><span class="page-history">在 <a href="https://docs.unity3d.com/2019.1/Documentation/Manual/30_search.html?q=newin20191">2019.1</a> 中添加了“可编程渲染管线 SRP Batcher”<span class="search-words">NewIn20191</span></span></p></li>
</ul>
<!-- area:graphics -->
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="srp-using-scriptable-render-context.html"></a></span><div class="tip">在可编程渲染管线中调度和执行渲染命令</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="CamerasOverview.html"></a></span><div class="tip">摄像机</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">版权所有 © 2020 Unity Technologies. Publication 2019.4</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
