<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script> -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="Codeless IAP - Unity 手册">
<title>Codeless IAP - Unity 手册</title>
<meta property="og:image" content="https://docs.unity3d.com/cn/2019.4/uploads/Main/CreateButton.png">
<meta name="description" content="Codeless IAP 是在 Unity 应用程序中实现应用内购 (IAP) 的最简单方法。借助 Unity Editor 提供的一个接口，只需编写最少的脚本即可配置基本的 IAP 集成。">
<meta property="og:description" content="Codeless IAP 是在 Unity 应用程序中实现应用内购 (IAP) 的最简单方法。借助 Unity Editor 提供的一个接口，只需编写最少的脚本即可配置基本的 IAP 集成。">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'UnityIAPCodelessIAP';
      if(!page) page = 'index';
      var version = '2019.4';
      var docs_versions = [{version: '2021.1',version_string: '2021.1',supported: true},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: true},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2019.4/Manual/UnityIAPCodelessIAP.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2019.4/Manual/UnityIAPCodelessIAP.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2019.4/Manual/UnityIAPCodelessIAP.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2019.4/Manual/UnityIAPCodelessIAP.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2019.4/Manual/UnityIAPCodelessIAP.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2019.4/Manual/UnityIAPCodelessIAP.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2019.4/Manual/UnityIAPCodelessIAP.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2019.4/Documentation/Manual/UnityIAPCodelessIAP.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.4</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/UnityIAPCodelessIAP.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/UnityIAPCodelessIAP.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/UnityIAPCodelessIAP.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/UnityIAPCodelessIAP.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/UnityIAPCodelessIAP.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/UnityIAPCodelessIAP.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/UnityIAPCodelessIAP.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/UnityIAPCodelessIAP.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/UnityIAPCodelessIAP.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/UnityIAPCodelessIAP.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/UnityIAPCodelessIAP.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/UnityIAPCodelessIAP.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/UnityIAPCodelessIAP.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/UnityIAPCodelessIAP.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/UnityIAPCodelessIAP.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/UnityIAPCodelessIAP.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/UnityIAPCodelessIAP.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2019.4/Documentation/Manual/UnityIAPCodelessIAP.html">English</a></li>
<li><a data-lang="cn" href="/cn/2019.4/Manual/UnityIAPCodelessIAP.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2019.4/Manual/UnityIAPCodelessIAP.html">日本語</a></li>
<li><a data-lang="es" href="/es/2019.4/Manual/UnityIAPCodelessIAP.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2019.4/Manual/UnityIAPCodelessIAP.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2019.4/Manual/UnityIAPCodelessIAP.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.4</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/UnityIAPCodelessIAP.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/UnityIAPCodelessIAP.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/UnityIAPCodelessIAP.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/UnityIAPCodelessIAP.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/UnityIAPCodelessIAP.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/UnityIAPCodelessIAP.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/UnityIAPCodelessIAP.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/UnityIAPCodelessIAP.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/UnityIAPCodelessIAP.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/UnityIAPCodelessIAP.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/UnityIAPCodelessIAP.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/UnityIAPCodelessIAP.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/UnityIAPCodelessIAP.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/UnityIAPCodelessIAP.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/UnityIAPCodelessIAP.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/UnityIAPCodelessIAP.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/UnityIAPCodelessIAP.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity 用户手册 (2019.4 LTS)</a></li>
<li><a href="UnityServices.html">Unity 服务</a></li>
<li><a href="UnityIAP.html">﻿Unity IAP</a></li>
<li>跨平台指南</li>
<li>Codeless IAP</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="UnityIAPSamsungConfiguration.html"></a></span><div class="tip">Samsung Galaxy IAP 配置</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="UnityIAPDefiningProducts.html"></a></span><div class="tip">定义商品</div>
</div>
</div></div>
<h1>Codeless IAP</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p><strong>Codeless IAP</strong> 是在 Unity 应用程序中实现应用内购 (IAP) 的最简单方法。借助 Unity Editor 提供的一个接口，只需编写最少的脚本即可配置基本的 IAP 集成。</p>

<p>Codeless IAP 可处理实际的 IAP 交易而无需任何代码。在 Editor 中实现 Codeless IAP 的过程包括两个步骤：</p>

<p>1.<a href="#IAPButtons">将 __IAP 按钮__添加到游戏中</a>。
2.<a href="#PopulatingProducts">在 <strong>IAP Catalog</strong> 中定义__商品__</a>。</p>

<p><strong>Unity 购买__系统 (Unity Purchasing System) 在运行时配置您在目录中填充的商品。玩家选择 </strong>IAP 按钮__时，便会启动相关商品的购买流程。</p>

<p><strong>注意</strong>：您仍然需要通过编写脚本来定义玩家如何访问其新购买的内容。有关更多信息，请参阅以下的<a href="#PurchaseFulfillment"><strong>执行购买</strong></a>部分。</p>

<h2>实现 Codeless IAP</h2>

<p>开始之前，请安装最新的 <a href="https://assetstore.unity.com/packages/add-ons/services/billing/unity-iap-68207"><strong>Unity IAP</strong></a> SDK。请参阅有关<a href="https://docs.unity3d.com/2018.1/Documentation/Manual/UnityIAPSettingUp.html"><strong>设置 Unity IAP</strong></a> 的文档以了解更多信息。</p>

<p><a name="IAPButtons"></a> </p>

<h3>将 IAP 按钮添加到场景</h3>

<p>要将 <strong>IAP 按钮__添加到场景，请在 Unity Editor 中选择 </strong>Window &gt; Unity IAP &gt; Create IAP Button__。</p>

<figure>
<img src="../uploads/Main/CreateButton.png" alt="在 Unity Editor 中创建 Codeless IAP 按钮">
<figcaption>在 Unity Editor 中创建 Codeless <strong>IAP 按钮</strong></figcaption>
</figure>

<p><a name="PopulatingProducts"></a> </p>

<h3>在 IAP Catalog 中填充商品</h3>

<p>按以下两种方式之一打开 <strong>IAP Catalog</strong> GUI：</p>

<ul>
<li>选择 <strong>Window &gt; Unity IAP &gt; IAP Catalog</strong>。</li>
<li>或者，选中 <strong>IAP Button </strong>后，在 Inspector 中找到其 <strong>IAP Button (Script)</strong> 组件，然后单击 <strong>IAP Catalog…</strong>。</li>
</ul>

<figure>
<img src="../uploads/Main/OpenCatalogGUI.png" alt="通过 IAP Button 脚本组件来访问 IAP Catalog GUI">
<figcaption>通过 <strong>IAP Button</strong> 脚本组件来访问 <strong>IAP Catalog</strong> GUI</figcaption>
</figure>

<p>下一步，使用该 GUI 为目录中的每个商品定义以下属性。</p>

<ul>
<li>
<strong>Product ID__（商品 ID）：通过此 ID 与应用商店通信（请注意，可通过 </strong>Advanced__ 选项使用特定于商店的唯一 ID 来覆盖此 ID）。</li>
<li>
<strong>Product Type（商品类型）__：包括 </strong>Consumable__（消耗品）、<strong>Non-Consumable__（非消耗品）或 </strong>Subscription__（订阅）。</li>
</ul>

<figure>
<img src="../uploads/Main/IAPCatalogGUI.png" alt="在 IAP Catalog GUI 中填充商品信息">
<figcaption>在 <strong>IAP Catalog</strong> GUI 中填充商品信息</figcaption>
</figure>

<p><strong>注意</strong>：__IAP Catalog__ GUI 还提供可用于配置商品的其他工具。在<a href="#Exporting">导出目录</a>以便上传到各自商店之前，还必须填写描述和定价信息。有关这些设置的详细信息，请参阅有关<a href="https://docs.unity3d.com/2018.1/Documentation/Manual/UnityIAPDefiningProducts.html"><strong>定义商品</strong></a>的文档以了解。</p>

<h3>自动初始化 <code>UnityPurchasing</code>
</h3>

<p>必须初始化 IAP SDK 才能正常使用 IAP。在运行时加载 Codeless <strong>IAP 按钮__或 <a href="#IAPListeners"><strong>IAP 监听器</strong></a>的第一个实例时，自动进行此操作。但是，您可能需要在 IAP 按钮或 IAP 监听器出现在游戏中之前初始化 SDK（例如，在应用程序启动后提供<a href="https://docs.unity3d.com/2018.1/Documentation/Manual/IAPPromo.html"><strong>内购推荐 (IAP Promo)</strong></a> ）。在此类情况下，请选中 </strong>IAP Catalog__ 窗口底部的 <strong>Automatically initialize UnityPurchasing (recommended)</strong>。这样可以确保在应用程序启动时 <a href="https://docs.unity3d.com/2018.1/Documentation/ScriptReference/Purchasing.UnityPurchasing.html"><code>UnityPurchasing</code></a> 立即初始化，并消除对无码实例生命周期的依赖。</p>

<figure>
<img src="../uploads/Main/AutoInitialize.png" alt="通过 IAP Catalog GUI 启用 SDK 自动初始化">
<figcaption>通过 <strong>IAP Catalog</strong> GUI 启用 SDK 自动初始化</figcaption>
</figure>

<p>目录必须至少包含一个商品才能运行。</p>

<p><strong>注意</strong>：您可以将自动初始化功能与 IAP 按钮或监听器结合使用。在此情况下，SDK 会在游戏启动时初始化，而不是在场景中加载 IAP 按钮或监听器的第一个实例时初始化。但是，如果同时需要在脚本中手动初始化，则不应启用自动初始化，因为这可能导致错误。</p>

<p><a name="PurchaseFulfillment"></a> </p>

<h3>执行购买</h3>

<p>商品目录至少包含一个商品时，您可以定义在购买完成或失败时的 __IAP 按钮__行为。</p>

<p>1.在场景视图中选择 <strong>IAP 按钮__，然后在 Inspector 中找到其 </strong>IAP Button (Script)__ 组件。
2.从 <strong>Product ID</strong> 下拉列表中选择要链接到 <strong>IAP 按钮__的商品。
 <img src="../uploads/Main/ProductDropdown.png" alt="选择要与 Codeless IAP 按钮关联的商品">
3.创建自己的函数来执行购买，或者导入资源来实现此目的（请参阅以下代码示例）。
4.将购买执行脚本作为组件应用于游戏对象。
 <img src="../uploads/Main/PurchaseFulfillScript.png" alt="使用购买执行脚本来创建游戏对象">
5.返回到 Inspector 中的 </strong>IAP Button (Script)__ 组件，然后单击加号 (<strong>+</strong>) 按钮，从而将函数添加到 <strong>On Purchase Complete (Product)</strong> 列表。
6.将附带购买执行脚本的游戏对象拖到 <strong>On Purchase Complete (Product)</strong> 事件字段（如下图所示），然后从下拉菜单中选择您的函数。
 <img src="../uploads/Main/OnPurchaseComplete.png" alt="将购买执行脚本分配到 IAP Button 事件字段"></p>

<p><strong>购买执行脚本代码示例</strong>：</p>

<pre><code>public void GrantCredits (int credits){
    userCredits = userCredits + credits;
    Debug.Log("You received " + credits " Credits!");
}
</code></pre>

<p>运行游戏来测试 <strong>IAP 按钮</strong>。</p>

<h2>扩展功能</h2>

<p><a name="Exporting"></a> </p>

<h3>导出到应用商店</h3>

<p>为了使购买功能正常运行，必须在相应的应用商店中配置商品目录。为此，可将商品目录以 CSV 文件格式导出到 Google Play，或者以 XML 文件格式通过 Apple 的 Application Loader 导出到 iTunes Store。</p>

<h4>Google Play</h4>

<p>要将商品目录导出到 Google Play：</p>

<p>1.在 <strong>IAP Catalog</strong> 窗口 (<strong>Window &gt; Unity IAP &gt; IAP Catalog</strong>) 中，确保每个商品已定义以下字段：<br>* <strong>ID</strong> <br>* <strong>Type</strong> <br>* <strong>Title</strong> 和 <strong>Description</strong> <br>* <strong>Price</strong> 或 <strong>Pricing Template</strong> ID
2.向下滚动，然后选择 <strong>App Store Export</strong>。
3.选择 <strong>Google Play CSV</strong>。
4.选择要保存 CSV 文件的位置。</p>

<p>如需将导出的目录上传到 Google Play 的完整指南，请参阅 <a href="https://developer.android.com">Android 开发者 (Android Developers) 网站</a>上的 <a href="https://developer.android.com/google/play/billing/billing_admin.html#billing-list-setup">Google 应用内计费 (Google in-app billing)</a> 文档。</p>

<h4>Apple iTunes</h4>

<p>要将商品目录导出到 Apple iTunes：</p>

<p>1.在 <strong>IAP Catalog</strong> 窗口 (<strong>Window</strong> &gt; <strong>Unity IAP</strong> &gt; <strong>IAP Catalog</strong>) 中，确保每个商品已定义以下字段：<br>* <strong>ID</strong> <br>* <strong>Type</strong> <br>* <strong>Title</strong> 和 <strong>Description</strong> <br>* <strong>Price Tier</strong> 和 <strong>Screenshot path</strong> <br>*
<strong>Apple SKU</strong>（可在 <a href="https://itunesconnect.apple.com">iTunes Connect</a> 中找到）<br>* <strong>Apple Team ID</strong>（可在 <a href="https://developer.apple.com">Apple 开发者网站</a>中找到）
2.向下滚动，然后选择 <strong>App Store Export</strong>。
3.选择 <strong>Apple XML Delivery</strong>。
4.选择要保存 XML 文件的位置。</p>

<p>如需有关通过 Apple Application Loader 进行导入的完整指南，请参阅 <a href="https://itunesconnect.apple.com">iTunes Connect 网站</a>上的 <a href="https://itunesconnect.apple.com/docs/UsingApplicationLoader.pdf">Application Loader</a> 文档。</p>

<h3>Restore 按钮</h3>

<p>包括 iTunes 在内的一些应用商店要求应用程序具有 <strong>Restore</strong> 按钮。Codeless IAP 提供了一种在应用程序中实现 Restore 按钮的简单方法。</p>

<p>要添加 <strong>Restore</strong> 按钮：</p>

<p>1.将 <strong>IAP 按钮__添加到场景 (<strong>Window</strong> &gt; <strong>Unity IAP</strong> &gt; <strong>Create IAP Button</strong>)。
2.选择 </strong>IAP 按钮__后，在 Inspector 中找到其 <strong>IAP Button (Script)</strong> 组件，然后从 <strong>Button Type</strong> 下拉菜单中选择 <strong>Restore</strong>（该组件的大部分其他字段将从 Inspector 视图中消失）。
 <img src="../uploads/Main/RestoreButton.png" alt="修改 IAP 按钮以恢复购买"></p>

<p>用户在运行时选择此按钮时，该按钮会为当前商店调用购买恢复 API。此功能对 iOS App Store、Mac App Store、Windows 应用商店、Samsung Apps 和 Cloud Moolah 应用程序商店有效。在其他平台上，您可能希望隐藏 <strong>Restore</strong> 按钮。</p>

<p>如果恢复成功，Unity IAP 会在与该商品关联的 <strong>IAP 按钮__上调用 </strong>On Purchase Complete (Product)__ 函数。</p>

<p>有关更多信息，请参阅有关<a href="https://docs.unity3d.com/2018.1/Documentation/Manual/UnityIAPRestoringTransactions.html"><strong>恢复购买</strong></a>的文档。</p>

<p><a name="IAPListeners"></a> </p>

<h3>IAP 监听器</h3>

<p>Codeless IAP 将成功和失败的购买事件分发给层级视图中处于活动状态的 <strong>IAP 按钮</strong> (IAP Button) 组件。但是，在处理成功的购买时，有时可能会很难有或不希望有处于活动状态的 <strong>IAP 按钮</strong>。例如，如果购买在完成前中断，Unity IAP 会在下次初始化时再次尝试处理该购买。您可能希望在应用程序启动后立即执行此操作，在这种情况下，__IAP 按钮__不合逻辑。Codeless IAP 正好包含适合这些情况的 <strong>IAP 监听器</strong> (IAP Listener) 组件。场景层级视图中处于活动状态的 <strong>IAP 监听器__可接收无法分发给 </strong>IAP 按钮__的任何购买事件。</p>

<p>添加 __IAP 监听器__：</p>

<p>1.在 Unity Editor 中，选择 <strong>Window &gt; Unity IAP &gt; Create IAP Listener</strong>。
2.按照关于<a href="#PurchaseFulfillment">编写购买执行脚本作为游戏对象组件</a>的步骤执行操作。
3.在场景中选择 __IAP Listener__，并在 Inspector 中找到 <strong>IAP Listener (Script)</strong> 组件，然后单击加号 (<strong>+</strong>) 按钮，从而将函数添加到 <strong>On Purchase Complete (Product)</strong> 列表。
4.将附带购买执行脚本的游戏对象拖到该组件的 Inspector 中的事件字段，然后从下拉菜单中选择您的函数。
 <img src="../uploads/Main/IAPListenerScript.png" alt="配置 __IAP 监听器__以应对处理异常"></p>

<h3>访问 Unity IAP 的扩展功能</h3>

<p>Codeless IAP 功能未展示 Unity IAP 的大多数<a href="https://docs.unity3d.com/2018.1/Documentation/Manual/UnityIAPStoreExtensions.html">扩展功能</a>。但是，Codeless IAP 是基于现有脚本 API 实现的，因此可在 <em>IAPButton.cs</em> 脚本 (<em>Assets/Plugins/UnityPurchasing/script/IAPButton.cs</em>) 中修改其诸多功能以满足您的需求。</p>

<p>要使用 Unity IAP 的扩展功能，请访问由 <a href="https://docs.unity3d.com/2018.1/Documentation/ScriptReference/Purchasing.IStoreListener.OnInitialized.html"><code>IStoreListener.OnInitialize</code></a> 返回的 Unity IAP <a href="https://docs.unity3d.com/2018.1/Documentation/ScriptReference/Purchasing.IStoreController.html"><code>IStoreController</code></a> 和 <a href="https://docs.unity3d.com/2018.1/Documentation/ScriptReference/Purchasing.IExtensionProvider.html"><code>IExtensionProvider</code></a> 实例。</p>

<hr>

<ul>
<li><span class="page-edit">2018–05–30 页面已修订</span></li>
</ul>
<!-- area:monetization -->
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="UnityIAPSamsungConfiguration.html"></a></span><div class="tip">Samsung Galaxy IAP 配置</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="UnityIAPDefiningProducts.html"></a></span><div class="tip">定义商品</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">版权所有 © 2020 Unity Technologies. Publication 2019.4</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
