<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script> -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="TreeView - Unity 手册">
<title>TreeView - Unity 手册</title>
<meta property="og:image" content="https://docs.unity3d.com/cn/2019.4/uploads/Main/TreeViewAPI-0.png">
<meta name="description" content="本页面的信息假定读者已基本了解 IMGUI（即时模式 GUI）的概念。有关 IMGUI 和自定义 Editor 窗口的信息，请参阅扩展 Editor 和 IMGUI Unity 博客。">
<meta property="og:description" content="本页面的信息假定读者已基本了解 IMGUI（即时模式 GUI）的概念。有关 IMGUI 和自定义 Editor 窗口的信息，请参阅扩展 Editor 和 IMGUI Unity 博客。">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'TreeViewAPI';
      if(!page) page = 'index';
      var version = '2019.4';
      var docs_versions = [{version: '2021.1',version_string: '2021.1',supported: true},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: true},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2019.4/Manual/TreeViewAPI.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2019.4/Manual/TreeViewAPI.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2019.4/Manual/TreeViewAPI.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2019.4/Manual/TreeViewAPI.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2019.4/Manual/TreeViewAPI.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2019.4/Manual/TreeViewAPI.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2019.4/Manual/TreeViewAPI.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2019.4/Documentation/Manual/TreeViewAPI.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.4</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/TreeViewAPI.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/TreeViewAPI.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/TreeViewAPI.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/TreeViewAPI.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/TreeViewAPI.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/TreeViewAPI.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/TreeViewAPI.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/TreeViewAPI.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/TreeViewAPI.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/TreeViewAPI.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/TreeViewAPI.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/TreeViewAPI.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/TreeViewAPI.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/TreeViewAPI.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/TreeViewAPI.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/TreeViewAPI.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/TreeViewAPI.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2019.4/Documentation/Manual/TreeViewAPI.html">English</a></li>
<li><a data-lang="cn" href="/cn/2019.4/Manual/TreeViewAPI.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2019.4/Manual/TreeViewAPI.html">日本語</a></li>
<li><a data-lang="es" href="/es/2019.4/Manual/TreeViewAPI.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2019.4/Manual/TreeViewAPI.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2019.4/Manual/TreeViewAPI.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.4</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/TreeViewAPI.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/TreeViewAPI.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/TreeViewAPI.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/TreeViewAPI.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/TreeViewAPI.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/TreeViewAPI.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/TreeViewAPI.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/TreeViewAPI.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/TreeViewAPI.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/TreeViewAPI.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/TreeViewAPI.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/TreeViewAPI.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/TreeViewAPI.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/TreeViewAPI.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/TreeViewAPI.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/TreeViewAPI.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/TreeViewAPI.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity 用户手册 (2019.4 LTS)</a></li>
<li><a href="UnityOverview.html">在 Unity 中操作</a></li>
<li><a href="EditorFeatures.html">编辑器功能</a></li>
<li><a href="ExtendingTheEditor.html">扩展编辑器</a></li>
<li>TreeView</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="editor-CustomEditors.html"></a></span><div class="tip">自定义编辑器</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="ConfigurableEnterPlayMode.html"></a></span><div class="tip">可配置的进入运行模式</div>
</div>
</div></div>
<h1>TreeView</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>本页面的信息假定读者已基本了解 IMGUI（即时模式 GUI）的概念。有关 IMGUI 和自定义 Editor 窗口的信息，请参阅<a href="ExtendingTheEditor.html">扩展 Editor</a> 和 <a href="https://blogs.unity3d.com/2015/12/22/going-deep-with-imgui-and-editor-customization">IMGUI Unity 博客</a>。</p>

<p>TreeView 是一个 IMGUI 控件，用于显示可以展开和折叠的层级数据。使用 TreeView 可为 Editor 窗口创建高度定制化的列表视图和多列表格，并可将其与其他 IMGUI 控件和组件结合使用。</p>

<p>请参阅 Unity Scripting API 文档的 <a href="../ScriptReference/IMGUI.Controls.TreeView.html">TreeView</a> 页面以了解可用的 TreeView API 函数。</p>

<figure>
<img src="../uploads/Main/TreeViewAPI-0.png" alt="包含 MultiColumnHeader 和 SearchField 的 TreeView 示例。">
<figcaption>包含 MultiColumnHeader 和 SearchField 的 TreeView 示例。</figcaption>
</figure>

<p>请注意，TreeView 不是<a href="https://en.wikipedia.org/wiki/Tree_(data_structure)">树数据模型</a>。可以使用所需的任何树数据结构来构造 TreeView。这可以是 C# 树模型，也可以是基于 Unity 的树结构，如 <a href="../ScriptReference/Transform.html">Transform</a> 层级视图。</p>

<p>为了处理 TreeView 的渲染，需要确定一个扩展项（称为行）列表。每一行代表一个 <code>TreeViewItem</code>。每个 <code>TreeViewItem</code> 都包含父子信息，此信息可供 TreeView 用来处理导航（按键和鼠标输入）。</p>

<p>TreeView 有一个单独的根 <code>TreeViewItem</code>，此项是隐藏的，不会出现在 Editor 中。此项是所有其他项的根。</p>

<h2>重要的类和方法</h2>

<p>除了 TreeView 本身之外，最重要的类是 <a href="../ScriptReference/IMGUI.Controls.TreeViewItem.html">TreeViewItem</a> 和 <a href="../ScriptReference/IMGUI.Controls.TreeViewState.html">TreeViewState</a>。</p>

<p><strong>TreeViewState</strong> (<a href="../ScriptReference/IMGUI.Controls.TreeViewState.html">TreeViewState</a>) 包含与 Editor 中的 TreeView 字段交互时更改的状态信息，例如选择状态、展开状态、导航状态和滚动状态。<code>TreeViewState</code> 是唯一<a href="script-Serialization.html">可序列化</a>的状态。TreeView 本身不可序列化，而是根据构造或重载时所代表的数据进行重建。将 <code>TreeViewState</code> 添加为 <code>EditorWindow</code> 派生类中的字段，可确保在重新加载脚本或进入播放模式时不会丢失用户更改的状态（有关如何执行此操作的信息，请参阅关于<a href="ExtendingTheEditor.html">扩展 Editor</a> 的文档）。如需查看包含 <code>TreeViewState</code> 字段的类的示例，请参阅下面的<a href="#Example1"><em>示例 1：简单 TreeView</em></a>。</p>

<p><strong>TreeViewItem</strong> (<a href="../ScriptReference/IMGUI.Controls.TreeViewItem.html">TreeViewItem</a>) 包含有关单个 TreeView 项的数据，用于在 Editor 中构建树结构的表示。每个 <code>TreeViewItem</code> 必须以唯一的整数 ID（在 TreeView 中的所有项中是唯一的）进行构造。此 ID 用于在树中查找项、选择状态、展开状态和导航。如果树表示 Unity 对象，应为每个对象使用 <a href="../ScriptReference/Object.GetInstanceID.html">GetInstanceID</a> 作为 <code>TreeViewItem</code> 的 ID。在 Editor 中重新加载脚本或进入播放模式时，在 <code>TreeViewState</code> 中使用这些 ID 可以保持用户更改的状态（例如展开的项）。</p>

<p>所有 <code>TreeViewItems</code> 都有一个 <code>depth</code> 属性，表示视觉缩进。请参阅下面的<a href="#InitializingTreeView"><em>初始化 TreeView</em></a> 示例以了解更多信息。</p>

<p><strong>BuildRoot</strong> (<a href="../ScriptReference/IMGUI.Controls.TreeView.BuildRoot.html">BuildRoot</a>) 是 <code>TreeView</code> 类的单个抽象方法，必须实现该方法才能创建 TreeView。使用此方法可以创建树的根项。每次对树调用 <a href="../ScriptReference/IMGUI.Controls.TreeView.Reload.html">Reload</a> 时都会调用此方法。对于使用小数据集的简单树，应在 <code>BuildRoot</code> 中的根项下创建 <code>TreeViewItems</code> 的整个树。对于非常大的树，在每次重新加载时创建整个树不是最佳选择。在这种情况下，应先创建根，然后重写 <code>BuildRows</code> 方法，仅创建当前行的项。如需查看 <code>BuildRoot</code> 的用法示例，请参阅下面的<a href="#Example1"><em>示例 1：简单 TreeView</em></a>。</p>

<p><strong>BuildRows</strong> (<a href="../ScriptReference/IMGUI.Controls.TreeView.BuildRows.html">BuildRows</a>) 是一种虚拟方法，此方法的默认实现基于 <code>BuildRoot</code> 中创建的完整树来构建行列表。如果只在 <code>BuildRoot</code> 中创建了根，则应重写此方法来处理展开的行。请参阅下面的<a href="#InitializingTreeView">初始化 TreeView</a> 以了解更多信息。</p>

<figure>
<img src="../uploads/Main/TreeViewAPI-1.png" alt="">
</figure>

<p>这张图总结了 TreeView 生命周期中 <code>BuildRoot</code> 和 <code>BuildRows</code> 事件方法的排序和重复情况。请注意，每次调用 <code>Reload</code> 时都会调用一次 <code>BuildRoot</code> 方法。调用 <code>BuildRows</code> 的次数更频繁，因为在调用 <code>Reload</code> 时（在 <code>BuildRoot</code> 之后）会调用一次，而每次展开或折叠 <code>TreeViewItem</code> 时也会调用。</p>

<p><a name="InitializingTreeView"> </a> </p>

<h2>初始化 TreeView</h2>

<p>从 TreeView 对象调用 <code>Reload</code> 方法时，将初始化 TreeView。</p>

<p>可通过两种方法来设置 TreeView：</p>

<p>1.<strong>创建完整树</strong> - 为树模型数据中的所有项创建 <code>TreeViewItem</code>。这是默认设置，只需较少的代码即可设置。从 TreeView 对象调用 BuildRoot 时，将构建完整树。</p>

<p>2.<strong>仅创建展开的项</strong> - 这种方法要求重写 <code>BuildRows</code> 来手动控制显示的行，而 <code>BuildRoot</code> 仅用于创建根 <code>TreeViewItem</code>。这种方法最适合于大型数据集或经常更改的数据。</p>

<p>对于小型数据集或对于不经常更改的数据，请使用第一种方法。对大型数据集或经常更改的数据，请使用第二种方法，因为仅创建展开的项而非创建完整树的速度将更快。</p>

<p>可通过三种方式设置 TreeViewItem：</p>

<ul>
<li><p>创建从头开始初始化的具有子项、父项和深度的 <code>TreeViewItem</code>。</p></li>
<li><p>创建具有父项和子项的 <code>TreeViewItem</code>，然后使用 <a href="../ScriptReference/IMGUI.Controls.TreeView.SetupDepthsFromParentsAndChildren.html">SetupDepthsFromParentsAndChildren</a> 设置深度。</p></li>
<li><p>创建只有深度信息的 <code>TreeViewItem</code>，然后使用 <a href="../ScriptReference/IMGUI.Controls.TreeView.SetupDepthsFromParentsAndChildren.html">SetupDepthsFromParentsAndChildren</a> 设置父项和子项引用。</p></li>
</ul>

<h2>示例</h2>

<p>要查看下面显示的示例的项目和源代码，请下载 <a href="http://files.unity3d.com/mads/TreeViewExamples.zip">TreeViewExamples.zip</a>。</p>

<p><a name="Example1"> </a> </p>

<h3>示例 1：简单 TreeView</h3>

<figure>
<img src="../uploads/Main/TreeViewAPI-2.png" alt="">
</figure>

<p>要创建 TreeView，请创建一个扩展 <code>TreeView</code> 类的类，并实现抽象方法 <code>BuildRoot</code>。以下示例将创建一个简单 TreeView。</p>

<pre><code>class SimpleTreeView : TreeView
{
    public SimpleTreeView(TreeViewState treeViewState)
        : base(treeViewState)
    {
        Reload();
    }
        
    protected override TreeViewItem BuildRoot ()
    {
        // 每次调用 Reload 时都调用 BuildRoot，从而确保使用数据
        // 创建 TreeViewItem。此处，我们将创建固定的一组项。在真实示例中，
        // 应将数据模型传入 TreeView 以及从模型创建的项。

        // 此部分说明 ID 应该是唯一的。根项的深度
        // 必须为 -1，其余项的深度在此基础上递增。
        var root = new TreeViewItem {id = 0, depth = -1, displayName ="Root"};
        var allItems = new List&lt;TreeViewItem&gt; 
        {
            new TreeViewItem {id = 1, depth = 0, displayName = "Animals"},
            new TreeViewItem {id = 2, depth = 1, displayName = "Mammals"},
            new TreeViewItem {id = 3, depth = 2, displayName = "Tiger"},
            new TreeViewItem {id = 4, depth = 2, displayName = "Elephant"},
            new TreeViewItem {id = 5, depth = 2, displayName = "Okapi"},
            new TreeViewItem {id = 6, depth = 2, displayName = "Armadillo"},
            new TreeViewItem {id = 7, depth = 1, displayName = "Reptiles"},
            new TreeViewItem {id = 8, depth = 2, displayName = "Crocodile"},
            new TreeViewItem {id = 9, depth = 2, displayName = "Lizard"},
        };
            
        // 用于初始化所有项的 TreeViewItem.children 和 .parent 的实用方法。
        SetupParentsAndChildrenFromDepths (root, allItems);
            
        //返回树的根
        return root;
    }
}
</code></pre>

<p>此示例中使用了深度信息来构建 TreeView。最后，调用 <code>SetupDepthsFromParentsAndChildren</code> 来设置 <code>TreeViewItem</code> 的父项数据和子项数据。</p>

<p>请注意，可通过两种方法设置 <code>TreeViewItem</code>：直接设置父项和子项，或使用 <code>AddChild</code> 方法，如以下示例所示：</p>

<pre><code>protected override TreeViewItem BuildRoot()
{
    var root = new TreeViewItem      { id = 0, depth = -1, displayName = "Root" };
    var animals = new TreeViewItem   { id = 1, displayName = "Animals" };
    var mammals = new TreeViewItem   { id = 2, displayName = "Mammals" };
    var tiger = new TreeViewItem     { id = 3, displayName = "Tiger" };
    var elephant = new TreeViewItem  { id = 4, displayName = "Elephant" };
    var okapi = new TreeViewItem     { id = 5, displayName = "Okapi" };
    var armadillo = new TreeViewItem { id = 6, displayName = "Armadillo" };
    var reptiles = new TreeViewItem  { id = 7, displayName = "Reptiles" };
    var croco = new TreeViewItem     { id = 8, displayName = "Crocodile" };
    var lizard = new TreeViewItem    { id = 9, displayName = "Lizard" };

    root.AddChild(animals);
    animals.AddChild(mammals);
    animals.AddChild(reptiles);
    mammals.AddChild(tiger);
    mammals.AddChild(elephant);
    mammals.AddChild(okapi);
    mammals.AddChild(armadillo);
    reptiles.AddChild(croco);
    reptiles.AddChild(lizard);

    SetupDepthsFromParentsAndChildren(root);

    return root;
}
</code></pre>

<h4>上面的 <code>SimpleTreeView</code> 类的替代 <code>BuildRoot</code> 方法</h4>

<p>以下示例显示了包含 <code>SimpleTreeView</code> 的 <code>EditorWindow</code>。TreeView 以 <code>TreeViewState</code> 实例构造而成。TreeView 的实现函数应确定此视图状态的处理方式：状态是否应该持续到下一个 Unity 会话，或者是否应该仅在重新加载脚本之后（进入播放模式或重新编译脚本时）保留其状态。在此示例中，<code>TreeViewState</code> 在 <code>EditorWindow</code> 中被序列化，确保了 TreeView 在关闭并重新打开 Editor 时保留其状态。</p>

<pre><code>using System.Collections.Generic;
using UnityEngine;
using UnityEditor.IMGUI.Controls;

class SimpleTreeViewWindow : EditorWindow
{
    // SerializeField 用于确保将视图状态写入窗口
    // 布局文件。这意味着只要窗口未关闭，即使重新启动 Unity，也会保持
    // 状态。如果省略该属性，仍然会序列化/反序列化状态。
    [SerializeField] TreeViewState m_TreeViewState;

    //TreeView 不可序列化，因此应该通过树数据对其进行重建。
    SimpleTreeView m_SimpleTreeView;

    void OnEnable ()
    {
        //检查是否已存在序列化视图状态（在程序集重新加载后
        // 仍然存在的状态）
        if (m_TreeViewState == null)
            m_TreeViewState = new TreeViewState ();

        m_SimpleTreeView = new SimpleTreeView(m_TreeViewState);
    }

    void OnGUI ()
    {
        m_SimpleTreeView.OnGUI(new Rect(0, 0, position.width, position.height));
    }

    // 将名为 "My Window" 的菜单添加到 Window 菜单
    [MenuItem ("TreeView Examples/Simple Tree Window")]
    static void ShowWindow ()
    {
        // 获取现有打开的窗口；如果没有，则新建一个窗口：
        var window = GetWindow&lt;SimpleTreeViewWindow&gt; ();
        window.titleContent = new GUIContent ("My Window");
        window.Show ();
    }
}
</code></pre>

<h3>示例 2：多列 TreeView</h3>

<figure>
<img src="../uploads/Main/TreeViewAPI-3.png" alt="">
</figure>

<p>此示例展示了使用 <a href="../ScriptReference/IMGUI.Controls.MultiColumnHeader.html">MultiColumnHeader</a> 类的多列 TreeView。</p>

<p><code>MultiColumnHeader</code> 支持以下功能：对项重命名、多选、对项重新排序、使用常规 IMGUI 控件（如滑动条和对象字段）自定义行内容、对列进行排序以及对行进行过滤和搜索。</p>

<p>此示例使用 <code>TreeElement</code> 和 <code>TreeModel</code> 类创建数据模型。TreeView 从此“TreeModel”获取数据。此示例中内置了 <code>TreeElement</code> 和 <code>TreeModel</code> 类来演示 TreeView 类的功能。这些类已包含在 TreeView 示例项目 (<a href="http://files.unity3d.com/mads/TreeViewExamples.zip">TreeViewExamples.zip</a>) 中。此示例还显示了如何将树模型结构序列化为 <a href="../ScriptReference/ScriptableObject.html">ScriptableObject</a> 并保存在资源中。</p>

<pre><code>[Serializable]
//TreeElement 数据类已经过扩展以便保存额外数据，您可以在前端 TreeView 中显示和编辑这些数据。
internal class MyTreeElement : TreeElement
{
    public float floatValue1, floatValue2, floatValue3;
    public Material material;
    public string text = "";
    public bool enabled = true;

    public MyTreeElement (string name, int depth, int id) : base (name, depth, id)
    {
        floatValue1 = Random.value;
        floatValue2 = Random.value;
        floatValue3 = Random.value;
    }
}

</code></pre>

<p>以下 ScriptableObject 类可确保在序列化树时数据仍保留在资源中。</p>

<pre><code>[CreateAssetMenu (fileName = "TreeDataAsset", menuName = "Tree Asset", order = 1)]
public class MyTreeAsset : ScriptableObject
{
    [SerializeField] List&lt;MyTreeElement&gt; m_TreeElements = new List&lt;MyTreeElement&gt; ();

    internal List&lt;MyTreeElement&gt; treeElements
    {
        get { return m_TreeElements; }
        set { m_TreeElements = value; }
    }
}
</code></pre>

<h2>构造 MultiColumnTreeView 类</h2>

<p>以下示例显示了 <code>MultiColumnTreeView</code> 类的代码段，说明了如何实现多列 GUI。请在 TreeView 示例项目 (<a href="http://files.unity3d.com/mads/TreeViewExamples.zip">TreeViewExamples.zip</a>) 中查找完整的源代码。</p>

<pre><code>public MultiColumnTreeView (TreeViewState state, 
                            MultiColumnHeader multicolumnHeader, 
                            TreeModel&lt;MyTreeElement&gt; model) 
                            : base (state, multicolumnHeader, model)
{
    // 自定义设置
    rowHeight = 20;
    columnIndexForTreeFoldouts = 2;
    showAlternatingRowBackgrounds = true;
    showBorder = true;
    customFoldoutYOffset = (kRowHeights - EditorGUIUtility.singleLineHeight) * 0.5f; 
    extraSpaceBeforeIconAndLabel = kToggleWidth;
    multicolumnHeader.sortingChanged += OnSortingChanged;
            
    Reload();
}

</code></pre>

<p>上面代码示例的自定义更改中进行了以下调整：</p>

<ul>
<li><p><code>rowHeight = 20</code>：将默认高度（基于 <a href="../ScriptReference/EditorGUIUtility-singleLineHeight.html">EditorGUIUtility.singleLineHeight</a> 的 16 点）更改为 20，为 GUI 控件增加更多空间。</p></li>
<li><p><code>columnIndexForTreeFoldouts = 2</code>：在该示例中，因为此值设置为 2，折叠箭头显示在第三列中（请参阅上图）。如果未更改此值，折叠箭头将在第一列中显示，因为默认情况下“columnIndexForTreeFoldouts”为 0。</p></li>
<li><p><code>showAlternatingRowBackgrounds = true</code>：启用交替的行背景颜色，使每行的显示更清楚。</p></li>
<li><p><code>showBorder = true</code>：在 TreeView 周围留出边距，以便显示一个细边框将其与其余内容分隔开</p></li>
<li><p><code>customFoldoutYOffset = (kRowHeights - EditorGUIUtility.singleLineHeight) * 0.5f</code>：使折叠箭头在行中垂直居中 - 请参阅下面的<a href="#CustomizingGUI">自定义 GUI</a>。</p></li>
<li><p><code>extraSpaceBeforeIconAndLabel = 20</code>：在树标签前留出空间，以便显示开关按钮。</p></li>
<li><p><code>multicolumnHeader.sortingChanged += OnSortingChanged</code>：为事件分配一个方法，用于检测标题组件中排序何时发生更改（单击标题列时）以便 TreeView 的行也更改以反映排序状态。</p></li>
</ul>

<p><a name="CustomizingGUI"> </a> </p>

<h2>自定义 GUI</h2>

<p>如果使用默认的 RowGUI 处理方法，TreeView 将看起来与上面的 <code>SimpleTreeView</code> 示例相似，只包含折叠箭头和标签。为每一项使用多个数据值时，必须重写 RowGUI 方法来显示这些值。</p>

<pre><code>protected override void RowGUI (RowGUIArgs args)
</code></pre>

<p>以下代码示例是 <code>RowGUIArgs</code> 结构的参数结构。</p>

<pre><code>protected struct RowGUIArgs
{
    public TreeViewItem item;
    public string label;
    public Rect rowRect;
    public int row;
    public bool selected;
    public bool focused;
    public bool isRenaming;

    public int GetNumVisibleColumns ()
    public int GetColumn (int visibleColumnIndex)
    public Rect GetCellRect (int visibleColumnIndex)
}
</code></pre>

<p>可以扩展 <code>TreeViewItem</code> 并添加更多用户数据（创建一个派生自 <code>TreeViewItem</code> 的类）。然后，可以在 RowGUI 回调中使用此用户数据。下面提供了一个这样的示例。请参阅 <code>override void RowGUI</code> - 此示例将输入项转换为 <code>TreeViewItem&lt;MyTreeElement&gt;</code>。</p>

<p>有三个与列处理相关的方法：<a href="../ScriptReference/IMGUI.Controls.TreeView.RowGUIArgs.GetNumVisibleColumns.html">GetNumVisibleColumns</a>、<a href="../ScriptReference/IMGUI.Controls.MultiColumnHeader.GetColumn.html">GetColumn</a> 和 <a href="../ScriptReference/IMGUI.Controls.MultiColumnHeader.GetCellRect.html">GetCellRect</a>。只有在使用 <a href="../ScriptReference/IMGUI.Controls.MultiColumnHeader.html">MultiColumnHeader</a> 构造 TreeView 时才能调用这些方法，否则会抛出异常。</p>

<pre><code>protected override void RowGUI (RowGUIArgs args)
{
    var item = (TreeViewItem&lt;MyTreeElement&gt;) args.item;

    for (int i = 0; i &lt; args.GetNumVisibleColumns (); ++i)
    {
        CellGUI(args.GetCellRect(i), item, (MyColumns)args.GetColumn(i), ref args);
    }
}
</code></pre>

<pre><code>void CellGUI (Rect cellRect, TreeViewItem&lt;MyTreeElement&gt; item, MyColumns column, ref RowGUIArgs args)
{
    // 使用 EditorGUIUtility.singleLineHeight 垂直居中单元格。
// 这样可以更轻松地在单元格中放置控件和图标。
    CenterRectUsingSingleLineHeight(ref cellRect);

    switch (column)
    {

        case MyColumns.Icon1:
            
            // 绘制自定义纹理
GUI.DrawTexture(cellRect, s_TestIcons[GetIcon1Index(item)], ScaleMode.ScaleToFit);
            break;

        case MyColumns.Icon2:

//绘制自定义纹理
            GUI.DrawTexture(cellRect, s_TestIcons[GetIcon2Index(item)], ScaleMode.ScaleToFit);
            break;

        case MyColumns.Name:

            // 在标签文本的左侧创建一个开关按钮
            Rect toggleRect = cellRect;
            toggleRect.x += GetContentIndent(item);
            toggleRect.width = kToggleWidth;
            if (toggleRect.xMax &lt; cellRect.xMax)
                item.data.enabled = EditorGUI.Toggle(toggleRect, item.data.enabled); 

            // 默认图标和标签
            args.rowRect = cellRect;
            base.RowGUI(args);
            break;

        case MyColumns.Value1:

// 显示值 1 的 Slider 控件
            item.data.floatValue1 = EditorGUI.Slider(cellRect, GUIContent.none, item.data.floatValue1, 0f, 1f);
            break;

        case MyColumns.Value2:

// 显示材质的 ObjectField
            item.data.material = (Material)EditorGUI.ObjectField(cellRect, GUIContent.none, item.data.material, 
                                          typeof(Material), false);
            break;

        case MyColumns.Value3:

// 显示数据文本字符串的 TextField
            item.data.text = GUI.TextField(cellRect, item.data.text);
            break;
    }
}
</code></pre>

<h2>关于 TreeView 的常见问题解答</h2>

<p><strong>问：在我的 TreeView 子类中有函数 <a href="../ScriptReference/IMGUI.Controls.TreeView.BuildRoot.html">BuildRoot</a> 和 <a href="http://treeview.rowgui">RowGUI</a>。为构建函数中添加的每个 <code>TreeViewItem</code> 都调用 <code>RowGUI</code>，还是仅针对屏幕上滚动视图中可见的项调用该方法？</strong></p>

<p>答：仅针对屏幕上可见的项调用 <code>RowGUI</code>。例如，如果有 10,000 项，仅针对屏幕上的 20 个可见项调用 <code>RowGUI</code>。</p>

<p><strong>问：我可以获取屏幕上可见行的索引吗？</strong></p>

<p>答：可以。使用 <a href="../ScriptReference/IMGUI.Controls.TreeView.GetFirstAndLastVisibleRows.html">GetFirstAndLastVisibleRows</a> 方法。</p>

<p><strong>问：我可以获取 <a href="../ScriptReference/IMGUI.Controls.TreeView.BuildRows.html">BuildRows</a> 中构建的行列表吗？</strong></p>

<p>答：可以。使用 <a href="../ScriptReference/IMGUI.Controls.TreeView.GetRows.html">GetRows</a> 方法。</p>

<p><strong>问：任何被重写的函数都必须调用 <code>base.Method</code> 吗？</strong></p>

<p>答：仅当该方法具有要扩展的默认行为时才需要。</p>

<p><strong>问：我只想创建项列表（不是树）。必须创建根吗？</strong></p>

<p>答：是的，必须有一个根。可以创建根项并设置 <code>root.children = rows</code> 来加快设置。</p>

<p><strong>问：我已经在行中添加了一个 Toggle，为什么我点击它时，不能跳转选到这一行？</strong></p>

<p>答：默认情况下，只有在行内容不占用鼠标时才会选中该行。在这里，您的 Toggle 消耗了这个事件。要解决此问题，请在调用 Toggle 按钮之前使用 <a href="../ScriptReference/IMGUI.Controls.TreeView.SelectionClick.html">SelectionClick</a> 方法。</p>

<p><strong>问：在调用所有 <code>RowGUI</code> 方法之前或之后，是否可以使用其他方法？</strong></p>

<p>答：可以。请参阅 <a href="../ScriptReference/IMGUI.Controls.TreeView.BeforeRowsGUI.html">BeforeRowsGUI</a> 和 <a href="../ScriptReference/IMGUI.Controls.TreeView.AfterRowsGUI.html">AfterRowsGUI</a> 的 API 文档。</p>

<p><strong>问：有没有一种简单的方法可以将按键焦点从 API 返回到 TreeView？如果我在行中选择 <a href="../ScriptReference/EditorGUI.FloatField.html">FloatField</a>，该行的选择功能变为灰色。如何让它再次变蓝？</strong></p>

<p>答：蓝色表示当前具有按键焦点的行。由于 FloatField 获得了焦点，因此 TreeView 会失去焦点，所以这是预期的行为。在需要时设置 <code>GUIUtility.keyboardControl = treeViewControlID</code>。</p>

<p><strong>问：如何将 <code>id</code> 转换为 <code>TreeViewItem</code>？</strong></p>

<p>答：使用 FindItem 或 FindRows。</p>

<p><strong>问：当用户在 TreeView 中更改其选择时，我如何收到回调？</strong></p>

<p>答：重写 <a href="../ScriptReference/IMGUI.Controls.TreeView.SelectionChanged.html">SelectionChanged</a> 方法（其他有用的回调：<a href="../ScriptReference/IMGUI.Controls.TreeView.DoubleClickedItem.html">DoubleClickedItem</a> 和 <a href="../ScriptReference/IMGUI.Controls.TreeView.ContextClickedItem.html">ContextClickedItem</a>）。</p>
<!-- area:authoring -->
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="editor-CustomEditors.html"></a></span><div class="tip">自定义编辑器</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="ConfigurableEnterPlayMode.html"></a></span><div class="tip">可配置的进入运行模式</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">版权所有 © 2020 Unity Technologies. Publication 2019.4</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
