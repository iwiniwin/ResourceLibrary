<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script> -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="事件函数的执行顺序 - Unity 手册">
<title>事件函数的执行顺序 - Unity 手册</title>
<meta property="og:image" content="https://docs.unity3d.com/cn/2019.4/uploads/Main/monobehaviour_flowchart.svg">
<meta name="description" content="运行 Unity 脚本会按预定顺序执行大量事件函数。本页面将介绍这些事件函数，并说明它们的执行顺序。">
<meta property="og:description" content="运行 Unity 脚本会按预定顺序执行大量事件函数。本页面将介绍这些事件函数，并说明它们的执行顺序。">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'ExecutionOrder';
      if(!page) page = 'index';
      var version = '2019.4';
      var docs_versions = [{version: '2021.1',version_string: '2021.1',supported: true},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: true},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2019.4/Manual/ExecutionOrder.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2019.4/Manual/ExecutionOrder.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2019.4/Manual/ExecutionOrder.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2019.4/Manual/ExecutionOrder.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2019.4/Manual/ExecutionOrder.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2019.4/Manual/ExecutionOrder.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2019.4/Manual/ExecutionOrder.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2019.4/Documentation/Manual/ExecutionOrder.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.4</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/ExecutionOrder.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/ExecutionOrder.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/ExecutionOrder.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/ExecutionOrder.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/ExecutionOrder.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/ExecutionOrder.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/ExecutionOrder.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/ExecutionOrder.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/ExecutionOrder.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/ExecutionOrder.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/ExecutionOrder.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/ExecutionOrder.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/ExecutionOrder.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/ExecutionOrder.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/ExecutionOrder.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/ExecutionOrder.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/ExecutionOrder.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2019.4/Documentation/Manual/ExecutionOrder.html">English</a></li>
<li><a data-lang="cn" href="/cn/2019.4/Manual/ExecutionOrder.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2019.4/Manual/ExecutionOrder.html">日本語</a></li>
<li><a data-lang="es" href="/es/2019.4/Manual/ExecutionOrder.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2019.4/Manual/ExecutionOrder.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2019.4/Manual/ExecutionOrder.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.4</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/ExecutionOrder.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/ExecutionOrder.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/ExecutionOrder.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/ExecutionOrder.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/ExecutionOrder.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/ExecutionOrder.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/ExecutionOrder.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/ExecutionOrder.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/ExecutionOrder.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/ExecutionOrder.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/ExecutionOrder.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/ExecutionOrder.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/ExecutionOrder.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/ExecutionOrder.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/ExecutionOrder.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/ExecutionOrder.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/ExecutionOrder.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity 用户手册 (2019.4 LTS)</a></li>
<li><a href="ScriptingSection.html">脚本</a></li>
<li><a href="ScriptingConcepts.html">脚本概述</a></li>
<li>事件函数的执行顺序</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="Attributes.html"></a></span><div class="tip">特性</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="UnderstandingAutomaticMemoryManagement.html"></a></span><div class="tip">了解自动内存管理</div>
</div>
</div></div>
<h1>事件函数的执行顺序</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>运行 Unity 脚本会按预定顺序执行大量事件函数。本页面将介绍这些事件函数，并说明它们的执行顺序。</p>

<h2>脚本生命周期概述</h2>

<p>下图概括了 Unity 如何在脚本的生命周期内对事件函数进行排序以及重复执行这些事件函数。</p>

<p>有关各种事件函数的更多信息，请参阅以下部分：</p>

<ul>
<li><a href="#FirstSceneLoad">加载第一个场景</a></li>
<li><a href="#Editor">Editor</a></li>
<li><a href="#BeforeTheFirstFrameUpdate">在第一次帧更新之前</a></li>
<li><a href="#InBetweenFrames">帧之间</a></li>
<li><a href="#UpdateOrder">更新顺序</a></li>
<li><a href="#AnimationUpdateLoop">动画更新循环</a></li>
<li><a href="#Rendering">渲染</a></li>
<li><a href="#Coroutines">协程</a></li>
<li><a href="#WhenTheObjectIsDestroyed">销毁对象时</a></li>
<li><a href="#WhenQuitting">退出时</a></li>
</ul>

<p><a name="ScriptLifecycleFlowchart"></a></p>

<h3>脚本生命周期流程图</h3>

<figure>
<img src="../uploads/Main/monobehaviour_flowchart.svg" alt="">
</figure>

<p><strong>注意</strong>：有些浏览器不支持 SVG 图像文件。如果以上图像未正确显示（例如，如果看不到任何文字），请尝试其他浏览器，例如 <a href="https://www.google.com/chrome/">Google Chrome</a> 或 <a href="https://www.mozilla.org/">Mozilla Firefox</a>。</p>

<p><a name="FirstSceneLoad"></a></p>

<h2>加载第一个场景</h2>

<p>场景开始时将调用以下函数（为场景中的每个对象调用一次）。</p>

<ul>
<li>
<strong>Awake：</strong>始终在任何 Start 函数之前并在实例化预制件之后调用此函数。（如果游戏对象在启动期间处于非活动状态，则在激活之后才会调用 Awake。）</li>
<li>
<strong>OnEnable：</strong>（仅在对象处于激活状态时调用）在启用对象后立即调用此函数。在创建 MonoBehaviour 实例时（例如加载关卡或实例化具有脚本组件的游戏对象时）会执行此调用。</li>
<li>
<strong>OnLevelWasLoaded：</strong>执行此函数可告知游戏已加载新关卡。</li>
</ul>

<p>请注意，对于添加到场景中的对象，在为任何对象调用 Start 和 Update 等函数之前，会为_所有_脚本调用 Awake 和 OnEnable 函数。当然，在游戏运行过程中实例化对象时，不能强制执行此调用。</p>

<p><a name="Editor"></a> </p>

<h2>Editor</h2>

<ul>
<li>
<strong>Reset：</strong>调用 Reset 可以在脚本首次附加到对象时以及使用 <em>Reset</em> 命令时初始化脚本的属性。</li>
</ul>

<p><a name="BeforeTheFirstFrameUpdate"></a></p>

<h2>在第一次帧更新之前</h2>

<ul>
<li>
<strong>Start：</strong>仅当启用脚本实例后，才会在第一次帧更新之前调用 Start。</li>
</ul>

<p>对于添加到场景中的对象，在为任何脚本调用 Update 等函数之前，将在所有脚本上调用 Start 函数。当然，在游戏运行过程中实例化对象时，不能强制执行此调用。</p>

<p><a name="InBetweenFrames"></a></p>

<h2>帧之间</h2>

<ul>
<li>
<strong>OnApplicationPause：</strong>在帧的结尾处调用此函数（在正常帧更新之间有效检测到暂停）。在调用 <strong>OnApplicationPause</strong> 之后，将发出一个额外帧，从而允许游戏显示图形来指示暂停状态。</li>
</ul>

<p><a name="UpdateOrder"></a></p>

<h2>更新顺序</h2>

<p>跟踪游戏逻辑和交互、动画、摄像机位置等的时候，可以使用一些不同事件。常见方案是在 <strong>Update</strong> 函数中执行大多数任务，但是也可以使用其他函数。</p>

<ul>
<li><p><strong>FixedUpdate：</strong>调用 <strong>FixedUpdate</strong> 的频度常常超过 <strong>Update</strong>。如果帧率很低，可以每帧调用该函数多次；如果帧率很高，可能在帧之间完全不调用该函数。在 <strong>FixedUpdate</strong> 之后将立即进行所有物理计算和更新。在 <strong>FixedUpdate</strong> 内应用运动计算时，无需将值乘以 <strong>Time.deltaTime</strong>。这是因为 <strong>FixedUpdate</strong> 的调用基于可靠的计时器（独立于帧率）。</p></li>
<li><p><strong>Update：</strong>每帧调用一次 <strong>Update</strong>。这是用于帧更新的主要函数。</p></li>
<li><p><strong>LateUpdate：</strong>每帧调用一次 <strong>LateUpdate__（在 </strong>Update__ 完成后）。<strong>LateUpdate</strong> 开始时，在 <strong>Update</strong> 中执行的所有计算便已完成。<strong>LateUpdate</strong> 的常见用途是跟随第三人称摄像机。如果在 <strong>Update</strong> 内让角色移动和转向，可以在 <strong>LateUpdate</strong> 中执行所有摄像机移动和旋转计算。这样可以确保角色在摄像机跟踪其位置之前已完全移动。</p></li>
</ul>

<p><a name="AnimationUpdateLoop"></a></p>

<h2>动画更新循环</h2>

<p>Unity 评估动画系统时，将调用以下函数和 <a href="Profiler.html">Profiler</a> 标记。</p>

<ul>
<li><p><strong>OnStateMachineEnter：</strong>在<strong>状态机更新 (State Machine Update)</strong> 步骤中，当控制器的状态机进行流经 Entry 状态的转换时，将在第一个更新帧上调用此回调。在转换到 <strong>StateMachine</strong> 子状态时不会调用此回调。<br><br>仅当动画图中存在控制器组件（例如，<a href="../ScriptReference/Animations.AnimatorController.html"><strong>AnimatorController</strong></a>、<a href="../ScriptReference/AnimatorOverrideController.html"><strong>AnimatorOverrideController</strong></a> 或 <a href="../ScriptReference/Animations.AnimatorControllerPlayable.html"><strong>AnimatorControllerPlayable</strong></a>）时才会发生此回调。<br><br>
<strong>注意：</strong>将此回调添加到 <a href="../ScriptReference/StateMachineBehaviour.html"><strong>StateMachineBehaviour</strong></a> 组件会禁用多线程的状态机评估。</p></li>
<li><p><strong>OnStateMachineExit：</strong>在<strong>状态机更新 (State Machine Update)</strong> 步骤中，当控制器的状态机进行流经 Exit 状态的转换时，将在最后一个更新帧上调用此回调。在转换到 <strong>StateMachine</strong> 子状态时不会调用此回调。<br><br>仅当动画图中存在控制器组件（例如，<a href="../ScriptReference/Animations.AnimatorController.html"><strong>AnimatorController</strong></a>、<a href="../ScriptReference/AnimatorOverrideController.html"><strong>AnimatorOverrideController</strong></a> 或 <a href="../ScriptReference/Animations.AnimatorControllerPlayable.html"><strong>AnimatorControllerPlayable</strong></a>）时才会发生此回调。<br><br><strong>注意：</strong>将此回调添加到 <a href="../ScriptReference/StateMachineBehaviour.html"><strong>StateMachineBehaviour</strong></a> 组件会禁用多线程的状态机评估。</p></li>
<li><p><strong>触发动画事件 (Fire Animation Events)：</strong>调用在上次更新时间和当前更新时间之间采样的所有剪辑中的所有动画事件。</p></li>
<li><p><strong>StateMachineBehaviour (OnStateEnter/OnStateUpdate/OnStateExit)：</strong>一个层最多可以有 3 个活动状态：当前状态、中断状态和下一个状态。使用一个定义 <strong>OnStateEnter</strong>、<strong>OnStateUpdate</strong> 或 <strong>OnStateExit</strong> 回调的 StateMachineBehaviour 组件为每个活动状态调用此函数。<br><br>依次针对当前状态、中断状态和下一个状态调用此函数。<br><br>仅当动画图中存在控制器组件（例如，<a href="../ScriptReference/Animations.AnimatorController.html"><strong>AnimatorController</strong></a>、<a href="../ScriptReference/AnimatorOverrideController.html"><strong>AnimatorOverrideController</strong></a> 或 <a href="../ScriptReference/Animations.AnimatorControllerPlayable.html"><strong>AnimatorControllerPlayable</strong></a>）时才会执行此步骤。</p></li>
<li><p><strong>OnAnimatorMove：</strong>在每个更新帧中为每个 Animator 组件调用一次此函数来修改根运动 (Root Motion)。</p></li>
<li><p><strong>StateMachineBehaviour(OnStateMove)：</strong>使用定义此回调的 <a href="../ScriptReference/StateMachineBehaviour.html"><strong>StateMachineBehaviour</strong></a> 在每个活动状态中调用此函数。</p></li>
<li><p><strong>OnAnimatorIK：</strong>设置动画 IK。为每个启用 <strong>IK pass</strong> 的 Animator Controller 层进行一次此调用。<br><br>仅当使用人形骨架时才会执行此事件。</p></li>
<li><p><strong>StateMachineBehaviour(OnStateIK)：</strong>使用在启用 <strong>IK pass</strong> 的层上定义此回调的 <a href="../ScriptReference/StateMachineBehaviour.html"><strong>StateMachineBehaviour</strong></a> 组件在每个活动状态中调用此函数。</p></li>
<li><p><strong>WriteProperties：</strong>从主线程将所有其他动画属性写入场景。</p></li>
</ul>

<h3>有用的性能分析标记</h3>

<p><a href="#ScriptLifecycleFlowchart">脚本生命周期流程图</a>中显示的某些动画函数不是可以调用的事件函数；它们是 Unity 处理动画时调用的内部函数。</p>

<p>这些函数具有 Profiler 标记，因此您可以使用 <a href="Profiler.html">Profiler</a> 查看 Unity 在帧中调用这些函数的时间。知道 Unity 调用这些函数的时间有助于准确了解所调用的事件函数的具体执行时间。</p>

<p>例如，假设在 <strong>FireAnimationEvents</strong> 回调中调用 <a href="../ScriptReference/Animator.Play.html">Animator.Play</a>。如果知道只有在执行<strong>状态机更新 (State Machine Update)</strong> 和<strong>流程图 (Process Graph)</strong> 函数后才会触发 <strong>FireAnimationEvents</strong> 回调，就可以预期动画剪辑会在下一帧播放，而不是马上播放。</p>

<ul>
<li><p><strong>状态机更新 (State Machine Update)：</strong>在执行序列的此步骤中评估所有状态机。仅当动画图中存在控制器组件（例如，<a href="../ScriptReference/Animations.AnimatorController.html"><strong>AnimatorController</strong></a>、<a href="../ScriptReference/AnimatorOverrideController.html"><strong>AnimatorOverrideController</strong></a> 或 <a href="../ScriptReference/Animations.AnimatorControllerPlayable.html"><strong>AnimatorControllerPlayable</strong></a>）时才会发生此回调。<br><br><strong>注意：</strong>状态机评估通常是多线程的，但添加某些回调（例如，<strong>OnStateMachineEnter</strong> 和 <strong>OnStateMachineExit</strong>）会禁用多线程。请参数上文的<a href="#AnimationUpdateLoop">动画更新循环</a>以了解详细信息。</p></li>
<li><p><strong>ProcessGraph：</strong>评估所有动画图。此过程包括对需要评估的所有动画剪辑进行采样以及计算根运动 (Root Motion)。</p></li>
<li><p><strong>ProcessAnimation：</strong>混合动画图的结果。</p></li>
<li><p><strong>WriteTransforms：</strong>将所有动画变换从工作线程写入场景。<br><br>如果一个人形骨架的多个层启用了 <strong>IK pass</strong>，则该人形骨架可以有多个 <strong>WriteTransforms</strong> 通道（请参阅<a href="#ScriptLifecycleFlowchart">脚本生命周期流程图</a>）。</p></li>
</ul>

<p><a name="Rendering"></a></p>

<h2>Rendering</h2>

<ul>
<li>
<strong>OnPreCull：</strong>在摄像机剔除场景之前调用。剔除操作将确定摄像机可以看到哪些对象。正好在进行剔除之前调用 OnPreCull。</li>
<li>
<strong>OnBecameVisible/OnBecameInvisible：</strong>对象变为对任何摄像机可见/不可见时调用。</li>
<li>
<strong>OnWillRenderObject：</strong>如果对象可见，则为每个摄像机调用<strong>一次</strong>。</li>
<li>
<strong>OnPreRender：</strong>在摄像机开始渲染场景之前调用。</li>
<li>
<strong>OnRenderObject：</strong>所有常规场景渲染完成之后调用。此时，可以使用 <a href="../ScriptReference/GL.html">GL</a> 类或 <a href="../ScriptReference/Graphics.DrawMeshNow.html">Graphics.DrawMeshNow</a> 来绘制自定义几何形状。</li>
<li>
<strong>OnPostRender：</strong>在摄像机完成场景渲染后调用。</li>
<li>
<strong>OnRenderImage：</strong>在场景渲染完成后调用以允许对图像进行后处理，请参阅<a href="PostProcessingOverview.html">后期处理效果</a>。</li>
<li>
<strong>OnGUI：</strong>每帧调用多次以响应 GUI 事件。首先处理布局和重新绘制事件，然后为每个输入事件处理布局和键盘/鼠标事件。</li>
<li>
<strong>OnDrawGizmos</strong> 用于在场景视图中绘制辅助图标以实现可视化。</li>
</ul>

<p><a name="Coroutines"></a></p>

<h2>协程</h2>

<p>Update 函数返回后将运行正常协程更新。协程是一个可暂停执行 (yield) 直到给定的 YieldInstruction 达到完成状态的函数。
协程的不同用法：</p>

<ul>
<li>
<strong>yield</strong> 在下一帧上调用所有 Update 函数后，协程将继续。</li>
<li>
<strong>yield WaitForSeconds</strong> 在为帧调用所有 Update 函数后，在指定的时间延迟后继续协程</li>
<li>
<strong>yield WaitForFixedUpdate</strong> 在所有脚本上调用所有 FixedUpdate 后继续协程</li>
<li>
<strong>yield WWW</strong> 在 WWW 下载完成后继续。</li>
<li>
<strong>yield StartCoroutine</strong> 将协程链接起来，并会等待 MyFunc 协程先完成。</li>
</ul>

<p><a name="WhenTheObjectIsDestroyed"></a></p>

<h2>销毁对象时</h2>

<ul>
<li>
<strong>OnDestroy：</strong>对象存在的最后一帧完成所有帧更新之后，调用此函数（可能应 Object.Destroy 要求或在场景关闭时销毁该对象）。</li>
</ul>

<p><a name="WhenQuitting"></a></p>

<h2>退出时</h2>

<p>在场景中的所有活动对象上调用以下函数：</p>

<ul>
<li>
<strong>OnApplicationQuit：</strong>在退出应用程序之前在所有游戏对象上调用此函数。在编辑器中，用户停止播放模式时，调用函数。</li>
<li>
<strong>OnDisable：</strong>行为被禁用或处于非活动状态时，调用此函数。</li>
</ul>

<hr>

<ul>
<li><span class="page-edit">2019–03–18 页面已修订</span></li>
</ul>
<!-- area:core -->
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="Attributes.html"></a></span><div class="tip">特性</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="UnderstandingAutomaticMemoryManagement.html"></a></span><div class="tip">了解自动内存管理</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">版权所有 © 2020 Unity Technologies. Publication 2019.4</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
